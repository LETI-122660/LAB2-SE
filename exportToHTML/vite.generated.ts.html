<html>
<head>
<title>vite.generated.ts</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #bcbec4;}
.s1 { color: #7a7e85;}
.s2 { color: #bcbec4;}
.s3 { color: #cf8e6d;}
.s4 { color: #6aab73;}
.s5 { color: #c77dbb; font-style: italic;}
.s6 { color: #56a8f5;}
.s7 { color: #cf8e6d; font-style: italic;}
.s8 { color: #2aacb8; font-style: italic;}
.s9 { color: #bcbec4; font-style: italic;}
.s10 { color: #42c3d4;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
vite.generated.ts</font>
</center></td></tr></table>
<pre><span class="s0">/**</span>
 <span class="s1">* NOTICE: this is an auto-generated file 
 * 
 * This file has been generated by the `flow:prepare-frontend` maven goal. 
 * This file will be overwritten on every run. Any custom changes should be made to vite.config.ts 
 </span><span class="s0">*/</span>
<span class="s3">import </span><span class="s0">path </span><span class="s3">from </span><span class="s0">'</span><span class="s4">path</span><span class="s0">';</span>
<span class="s3">import </span><span class="s0">{ existsSync, mkdirSync, readdirSync, readFileSync, writeFileSync, Stats } </span><span class="s3">from </span><span class="s0">'</span><span class="s4">fs</span><span class="s0">';</span>
<span class="s3">import </span><span class="s0">{ createHash } </span><span class="s3">from </span><span class="s0">'</span><span class="s4">crypto</span><span class="s0">';</span>
<span class="s3">import </span><span class="s5">* </span><span class="s3">as </span><span class="s0">net </span><span class="s3">from </span><span class="s0">'</span><span class="s4">net</span><span class="s0">';</span>

<span class="s3">import </span><span class="s0">{ processThemeResources } </span><span class="s3">from </span><span class="s0">'</span><span class="s4">./target/plugins/application-theme-plugin/theme-handle.js</span><span class="s0">';</span>
<span class="s3">import </span><span class="s0">{ rewriteCssUrls } </span><span class="s3">from </span><span class="s0">'</span><span class="s4">./target/plugins/theme-loader/theme-loader-utils.js</span><span class="s0">';</span>
<span class="s3">import </span><span class="s0">{ addFunctionComponentSourceLocationBabel } </span><span class="s3">from </span><span class="s0">'</span><span class="s4">./target/plugins/react-function-location-plugin/react-function-location-plugin.js</span><span class="s0">';</span>
<span class="s3">import </span><span class="s0">settings </span><span class="s3">from </span><span class="s0">'</span><span class="s4">./target/vaadin-dev-server-settings.json</span><span class="s0">';</span>
<span class="s3">import </span><span class="s0">{</span>
  <span class="s0">AssetInfo,</span>
  <span class="s0">ChunkInfo,</span>
  <span class="s0">defineConfig,</span>
  <span class="s0">mergeConfig,</span>
  <span class="s0">OutputOptions,</span>
  <span class="s0">PluginOption,</span>
  <span class="s0">UserConfigFn</span>
<span class="s0">} </span><span class="s3">from </span><span class="s0">'</span><span class="s4">vite</span><span class="s0">';</span>

<span class="s3">import </span><span class="s5">* </span><span class="s3">as </span><span class="s0">rollup </span><span class="s3">from </span><span class="s0">'</span><span class="s4">rollup</span><span class="s0">';</span>
<span class="s3">import </span><span class="s0">brotli </span><span class="s3">from </span><span class="s0">'</span><span class="s4">rollup-plugin-brotli</span><span class="s0">';</span>
<span class="s3">import </span><span class="s0">checker </span><span class="s3">from </span><span class="s0">'</span><span class="s4">vite-plugin-checker</span><span class="s0">';</span>
<span class="s3">import </span><span class="s0">postcssLit </span><span class="s3">from </span><span class="s0">'</span><span class="s4">./target/plugins/rollup-plugin-postcss-lit-custom/rollup-plugin-postcss-lit.js</span><span class="s0">';</span>
<span class="s3">import </span><span class="s0">vaadinI18n </span><span class="s3">from </span><span class="s0">'</span><span class="s4">./target/plugins/rollup-plugin-vaadin-i18n/rollup-plugin-vaadin-i18n.js</span><span class="s0">';</span>
<span class="s3">import </span><span class="s0">serviceWorkerPlugin </span><span class="s3">from </span><span class="s0">'</span><span class="s4">./target/plugins/vite-plugin-service-worker</span><span class="s0">';</span>

<span class="s3">import </span><span class="s0">{ createRequire } </span><span class="s3">from </span><span class="s0">'</span><span class="s4">module</span><span class="s0">';</span>

<span class="s3">import </span><span class="s0">{ visualizer } </span><span class="s3">from </span><span class="s0">'</span><span class="s4">rollup-plugin-visualizer</span><span class="s0">';</span>
<span class="s3">import </span><span class="s0">reactPlugin </span><span class="s3">from </span><span class="s0">'</span><span class="s4">@vitejs/plugin-react</span><span class="s0">';</span>



<span class="s0">// </span><span class="s1">Make `require` compatible with ES modules</span>
<span class="s3">const </span><span class="s0">require = </span><span class="s6">createRequire</span><span class="s2">(</span><span class="s3">import</span><span class="s0">.</span><span class="s2">meta</span><span class="s0">.url</span><span class="s2">)</span><span class="s0">;</span>

<span class="s3">const </span><span class="s0">frontendFolder = path.</span><span class="s6">resolve</span><span class="s2">(</span><span class="s0">__dirname, settings.frontendFolder</span><span class="s2">)</span><span class="s0">;</span>
<span class="s3">const </span><span class="s0">themeFolder = path.</span><span class="s6">resolve</span><span class="s2">(</span><span class="s0">frontendFolder, settings.themeFolder</span><span class="s2">)</span><span class="s0">;</span>
<span class="s3">const </span><span class="s0">frontendBundleFolder = path.</span><span class="s6">resolve</span><span class="s2">(</span><span class="s0">__dirname, settings.frontendBundleOutput</span><span class="s2">)</span><span class="s0">;</span>
<span class="s3">const </span><span class="s0">devBundleFolder = path.</span><span class="s6">resolve</span><span class="s2">(</span><span class="s0">__dirname, settings.devBundleOutput</span><span class="s2">)</span><span class="s0">;</span>
<span class="s3">const </span><span class="s0">devBundle = !!process.env.devBundle;</span>
<span class="s3">const </span><span class="s0">jarResourcesFolder = path.</span><span class="s6">resolve</span><span class="s2">(</span><span class="s0">__dirname, settings.jarResourcesFolder</span><span class="s2">)</span><span class="s0">;</span>
<span class="s3">const </span><span class="s0">themeResourceFolder = path.</span><span class="s6">resolve</span><span class="s2">(</span><span class="s0">__dirname, settings.themeResourceFolder</span><span class="s2">)</span><span class="s0">;</span>
<span class="s3">const </span><span class="s0">projectPackageJsonFile = path.</span><span class="s6">resolve</span><span class="s2">(</span><span class="s0">__dirname, '</span><span class="s4">package.json</span><span class="s0">'</span><span class="s2">)</span><span class="s0">;</span>

<span class="s3">const </span><span class="s0">buildOutputFolder = devBundle ? devBundleFolder : frontendBundleFolder;</span>
<span class="s3">const </span><span class="s0">statsFolder = path.</span><span class="s6">resolve</span><span class="s2">(</span><span class="s0">__dirname, devBundle ? settings.devBundleStatsOutput : settings.statsOutput</span><span class="s2">)</span><span class="s0">;</span>
<span class="s3">const </span><span class="s0">statsFile = path.</span><span class="s6">resolve</span><span class="s2">(</span><span class="s0">statsFolder, '</span><span class="s4">stats.json</span><span class="s0">'</span><span class="s2">)</span><span class="s0">;</span>
<span class="s3">const </span><span class="s0">bundleSizeFile = path.</span><span class="s6">resolve</span><span class="s2">(</span><span class="s0">statsFolder, '</span><span class="s4">bundle-size.html</span><span class="s0">'</span><span class="s2">)</span><span class="s0">;</span>
<span class="s3">const </span><span class="s0">i18nFolder = path.</span><span class="s6">resolve</span><span class="s2">(</span><span class="s0">__dirname, settings.i18nOutput</span><span class="s2">)</span><span class="s0">;</span>
<span class="s3">const </span><span class="s0">nodeModulesFolder = path.</span><span class="s6">resolve</span><span class="s2">(</span><span class="s0">__dirname, '</span><span class="s4">node_modules</span><span class="s0">'</span><span class="s2">)</span><span class="s0">;</span>
<span class="s3">const </span><span class="s0">webComponentTags = '';</span>

<span class="s3">const </span><span class="s0">projectIndexHtml = path.</span><span class="s6">resolve</span><span class="s2">(</span><span class="s0">frontendFolder, '</span><span class="s4">index.html</span><span class="s0">'</span><span class="s2">)</span><span class="s0">;</span>

<span class="s3">const </span><span class="s0">projectStaticAssetsFolders = </span><span class="s2">[</span>
  <span class="s0">path.</span><span class="s6">resolve</span><span class="s2">(</span><span class="s0">__dirname, '</span><span class="s4">src</span><span class="s0">', '</span><span class="s4">main</span><span class="s0">', '</span><span class="s4">resources</span><span class="s0">', '</span><span class="s4">META-INF</span><span class="s0">', '</span><span class="s4">resources</span><span class="s0">'</span><span class="s2">)</span><span class="s0">,</span>
  <span class="s0">path.</span><span class="s6">resolve</span><span class="s2">(</span><span class="s0">__dirname, '</span><span class="s4">src</span><span class="s0">', '</span><span class="s4">main</span><span class="s0">', '</span><span class="s4">resources</span><span class="s0">', '</span><span class="s4">static</span><span class="s0">'</span><span class="s2">)</span><span class="s0">,</span>
  <span class="s0">frontendFolder</span>
<span class="s2">]</span><span class="s0">;</span>

<span class="s0">// </span><span class="s1">Folders in the project which can contain application themes</span>
<span class="s3">const </span><span class="s0">themeProjectFolders = projectStaticAssetsFolders.</span><span class="s6">map</span><span class="s2">(</span><span class="s0">(folder) </span><span class="s3">=&gt; </span><span class="s0">path.</span><span class="s6">resolve</span><span class="s2">(</span><span class="s0">folder, settings.themeFolder</span><span class="s2">))</span><span class="s0">;</span>

<span class="s3">const </span><span class="s0">themeOptions = {</span>
  <span class="s2">devMode</span><span class="s0">: </span><span class="s5">false</span><span class="s0">,</span>
  <span class="s2">useDevBundle</span><span class="s0">: devBundle,</span>
  <span class="s0">// </span><span class="s1">The following matches folder 'frontend/generated/themes/'</span>
  <span class="s0">// </span><span class="s1">(not 'frontend/themes') for theme in JAR that is copied there</span>
  <span class="s2">themeResourceFolder</span><span class="s0">: path.</span><span class="s6">resolve</span><span class="s2">(</span><span class="s0">themeResourceFolder, settings.themeFolder</span><span class="s2">)</span><span class="s0">,</span>
  <span class="s2">themeProjectFolders</span><span class="s0">: themeProjectFolders,</span>
  <span class="s2">projectStaticAssetsOutputFolder</span><span class="s0">: devBundle</span>
    <span class="s0">? path.</span><span class="s6">resolve</span><span class="s2">(</span><span class="s0">devBundleFolder, '</span><span class="s4">../assets</span><span class="s0">'</span><span class="s2">)</span>
    <span class="s0">: path.</span><span class="s6">resolve</span><span class="s2">(</span><span class="s0">__dirname, settings.staticOutput</span><span class="s2">)</span><span class="s0">,</span>
  <span class="s2">frontendGeneratedFolder</span><span class="s0">: path.</span><span class="s6">resolve</span><span class="s2">(</span><span class="s0">frontendFolder, settings.generatedFolder</span><span class="s2">)</span>
<span class="s0">};</span>

<span class="s3">const </span><span class="s0">hasExportedWebComponents = </span><span class="s6">existsSync</span><span class="s2">(</span><span class="s0">path.</span><span class="s6">resolve</span><span class="s2">(</span><span class="s0">frontendFolder, '</span><span class="s4">web-component.html</span><span class="s0">'</span><span class="s2">))</span><span class="s0">;</span>
<span class="s3">const </span><span class="s0">commercialBannerComponent = path.</span><span class="s6">resolve</span><span class="s2">(</span><span class="s0">frontendFolder, settings.generatedFolder, '</span><span class="s4">commercial-banner.js</span><span class="s0">'</span><span class="s2">)</span><span class="s0">;</span>
<span class="s3">const </span><span class="s0">hasCommercialBanner = </span><span class="s6">existsSync</span><span class="s2">(</span><span class="s0">commercialBannerComponent</span><span class="s2">)</span><span class="s0">;</span>

<span class="s3">const </span><span class="s0">target = </span><span class="s2">[</span><span class="s0">'</span><span class="s4">safari15</span><span class="s0">', '</span><span class="s4">es2022</span><span class="s0">'</span><span class="s2">]</span><span class="s0">;</span>

<span class="s0">// </span><span class="s1">Block debug and trace logs.</span>
<span class="s0">console.</span><span class="s6">trace </span><span class="s0">= () </span><span class="s3">=&gt; </span><span class="s0">{};</span>
<span class="s0">console.</span><span class="s6">debug </span><span class="s0">= () </span><span class="s3">=&gt; </span><span class="s0">{};</span>

<span class="s3">function </span><span class="s6">statsExtracterPlugin</span><span class="s0">(): PluginOption {</span>
  <span class="s3">function </span><span class="s6">collectThemeJsonsInFrontend</span><span class="s0">(themeJsonContents: Record&lt;string, string&gt;, themeName: string) {</span>
    <span class="s3">const </span><span class="s0">themeJson = path.</span><span class="s6">resolve</span><span class="s2">(</span><span class="s0">frontendFolder, settings.themeFolder, themeName, '</span><span class="s4">theme.json</span><span class="s0">'</span><span class="s2">)</span><span class="s0">;</span>
    <span class="s3">if </span><span class="s2">(</span><span class="s6">existsSync</span><span class="s2">(</span><span class="s0">themeJson</span><span class="s2">)) </span><span class="s0">{</span>
      <span class="s3">const </span><span class="s0">themeJsonContent = </span><span class="s6">readFileSync</span><span class="s2">(</span><span class="s0">themeJson, { </span><span class="s2">encoding</span><span class="s0">: '</span><span class="s4">utf-8</span><span class="s0">' }</span><span class="s2">)</span><span class="s0">.</span><span class="s6">replace</span><span class="s2">(</span><span class="s0">/</span><span class="s5">\r\n</span><span class="s0">/</span><span class="s3">g</span><span class="s0">, '</span><span class="s7">\n</span><span class="s0">'</span><span class="s2">)</span><span class="s0">;</span>
      <span class="s0">themeJsonContents</span><span class="s2">[</span><span class="s0">themeName</span><span class="s2">] </span><span class="s0">= themeJsonContent;</span>
      <span class="s3">const </span><span class="s0">themeJsonObject = JSON.</span><span class="s6">parse</span><span class="s2">(</span><span class="s0">themeJsonContent</span><span class="s2">)</span><span class="s0">;</span>
      <span class="s3">if </span><span class="s2">(</span><span class="s0">themeJsonObject.parent</span><span class="s2">) </span><span class="s0">{</span>
        <span class="s6">collectThemeJsonsInFrontend</span><span class="s2">(</span><span class="s0">themeJsonContents, themeJsonObject.parent</span><span class="s2">)</span><span class="s0">;</span>
      <span class="s0">}</span>
    <span class="s0">}</span>
  <span class="s0">}</span>

  <span class="s3">return </span><span class="s0">{</span>
    <span class="s2">name</span><span class="s0">: '</span><span class="s4">vaadin:stats</span><span class="s0">',</span>
    <span class="s2">enforce</span><span class="s0">: '</span><span class="s4">post</span><span class="s0">',</span>
    <span class="s3">async </span><span class="s6">writeBundle</span><span class="s0">(options: OutputOptions, bundle: { </span><span class="s2">[</span><span class="s0">fileName: string</span><span class="s2">]</span><span class="s0">: AssetInfo | ChunkInfo }) {</span>
      <span class="s3">const </span><span class="s0">modules = Object.</span><span class="s6">values</span><span class="s2">(</span><span class="s0">bundle</span><span class="s2">)</span><span class="s0">.</span><span class="s6">flatMap</span><span class="s2">(</span><span class="s0">(b) </span><span class="s3">=&gt; </span><span class="s2">(</span><span class="s0">b.modules ? Object.</span><span class="s6">keys</span><span class="s2">(</span><span class="s0">b.modules</span><span class="s2">) </span><span class="s0">: </span><span class="s2">[]))</span><span class="s0">;</span>
      <span class="s3">const </span><span class="s0">nodeModulesFolders = modules</span>
        <span class="s0">.</span><span class="s6">map</span><span class="s2">(</span><span class="s0">(id) </span><span class="s3">=&gt; </span><span class="s0">id.</span><span class="s6">replace</span><span class="s2">(</span><span class="s0">/</span><span class="s7">\\</span><span class="s0">/</span><span class="s3">g</span><span class="s0">, '</span><span class="s4">/</span><span class="s0">'</span><span class="s2">))</span>
        <span class="s0">.</span><span class="s6">filter</span><span class="s2">(</span><span class="s0">(id) </span><span class="s3">=&gt; </span><span class="s0">id.</span><span class="s6">startsWith</span><span class="s2">(</span><span class="s0">nodeModulesFolder.</span><span class="s6">replace</span><span class="s2">(</span><span class="s0">/</span><span class="s7">\\</span><span class="s0">/</span><span class="s3">g</span><span class="s0">, '</span><span class="s4">/</span><span class="s0">'</span><span class="s2">)))</span>
        <span class="s0">.</span><span class="s6">map</span><span class="s2">(</span><span class="s0">(id) </span><span class="s3">=&gt; </span><span class="s0">id.</span><span class="s6">substring</span><span class="s2">(</span><span class="s0">nodeModulesFolder.</span><span class="s2">length </span><span class="s0">+ </span><span class="s8">1</span><span class="s2">))</span><span class="s0">;</span>
      <span class="s3">const </span><span class="s0">npmModules = nodeModulesFolders</span>
        <span class="s0">.</span><span class="s6">map</span><span class="s2">(</span><span class="s0">(id) </span><span class="s3">=&gt; </span><span class="s0">id.</span><span class="s6">replace</span><span class="s2">(</span><span class="s0">/</span><span class="s7">\\</span><span class="s0">/</span><span class="s3">g</span><span class="s0">, '</span><span class="s4">/</span><span class="s0">'</span><span class="s2">))</span>
        <span class="s0">.</span><span class="s6">map</span><span class="s2">(</span><span class="s0">(id) </span><span class="s3">=&gt; </span><span class="s0">{</span>
          <span class="s3">const </span><span class="s0">parts = id.</span><span class="s6">split</span><span class="s2">(</span><span class="s0">'</span><span class="s4">/</span><span class="s0">'</span><span class="s2">)</span><span class="s0">;</span>
          <span class="s3">if </span><span class="s2">(</span><span class="s0">id.</span><span class="s6">startsWith</span><span class="s2">(</span><span class="s0">'</span><span class="s4">@</span><span class="s0">'</span><span class="s2">)) </span><span class="s0">{</span>
            <span class="s3">return </span><span class="s0">parts</span><span class="s2">[</span><span class="s8">0</span><span class="s2">] </span><span class="s0">+ '</span><span class="s4">/</span><span class="s0">' + parts</span><span class="s2">[</span><span class="s8">1</span><span class="s2">]</span><span class="s0">;</span>
          <span class="s0">} </span><span class="s3">else </span><span class="s0">{</span>
            <span class="s3">return </span><span class="s0">parts</span><span class="s2">[</span><span class="s8">0</span><span class="s2">]</span><span class="s0">;</span>
          <span class="s0">}</span>
        <span class="s0">}</span><span class="s2">)</span>
        <span class="s0">.</span><span class="s6">sort</span><span class="s2">()</span>
        <span class="s0">.</span><span class="s6">filter</span><span class="s2">(</span><span class="s0">(value, index, self) </span><span class="s3">=&gt; </span><span class="s0">self.</span><span class="s6">indexOf</span><span class="s2">(</span><span class="s0">value</span><span class="s2">) </span><span class="s0">=== index</span><span class="s2">)</span><span class="s0">;</span>
      <span class="s3">const </span><span class="s0">npmModuleAndVersion = Object.</span><span class="s6">fromEntries</span><span class="s2">(</span><span class="s0">npmModules.</span><span class="s6">map</span><span class="s2">(</span><span class="s0">(module) </span><span class="s3">=&gt; </span><span class="s2">[</span><span class="s0">module, </span><span class="s6">getVersion</span><span class="s2">(</span><span class="s0">module</span><span class="s2">)]))</span><span class="s0">;</span>
      <span class="s3">const </span><span class="s0">cvdls = Object.</span><span class="s6">fromEntries</span><span class="s2">(</span>
        <span class="s0">npmModules</span>
          <span class="s0">.</span><span class="s6">filter</span><span class="s2">(</span><span class="s0">(module) </span><span class="s3">=&gt; </span><span class="s6">getCvdlName</span><span class="s2">(</span><span class="s0">module</span><span class="s2">) </span><span class="s0">!= </span><span class="s5">null</span><span class="s2">)</span>
          <span class="s0">.</span><span class="s6">map</span><span class="s2">(</span><span class="s0">(module) </span><span class="s3">=&gt; </span><span class="s2">[</span><span class="s0">module, { </span><span class="s2">name</span><span class="s0">: </span><span class="s6">getCvdlName</span><span class="s2">(</span><span class="s0">module</span><span class="s2">)</span><span class="s0">, </span><span class="s2">version</span><span class="s0">: </span><span class="s6">getVersion</span><span class="s2">(</span><span class="s0">module</span><span class="s2">) </span><span class="s0">}</span><span class="s2">])</span>
      <span class="s2">)</span><span class="s0">;</span>

      <span class="s6">mkdirSync</span><span class="s2">(</span><span class="s0">path.</span><span class="s6">dirname</span><span class="s2">(</span><span class="s0">statsFile</span><span class="s2">)</span><span class="s0">, { </span><span class="s2">recursive</span><span class="s0">: </span><span class="s5">true </span><span class="s0">}</span><span class="s2">)</span><span class="s0">;</span>
      <span class="s3">const </span><span class="s0">projectPackageJson = JSON.</span><span class="s6">parse</span><span class="s2">(</span><span class="s6">readFileSync</span><span class="s2">(</span><span class="s0">projectPackageJsonFile, { </span><span class="s2">encoding</span><span class="s0">: '</span><span class="s4">utf-8</span><span class="s0">' }</span><span class="s2">))</span><span class="s0">;</span>

      <span class="s3">const </span><span class="s0">entryScripts = Object.</span><span class="s6">values</span><span class="s2">(</span><span class="s0">bundle</span><span class="s2">)</span>
        <span class="s0">.</span><span class="s6">filter</span><span class="s2">(</span><span class="s0">(bundle) </span><span class="s3">=&gt; </span><span class="s0">bundle.isEntry</span><span class="s2">)</span>
        <span class="s0">.</span><span class="s6">map</span><span class="s2">(</span><span class="s0">(bundle) </span><span class="s3">=&gt; </span><span class="s0">bundle.fileName</span><span class="s2">)</span><span class="s0">;</span>

      <span class="s3">const </span><span class="s0">generatedIndexHtml = path.</span><span class="s6">resolve</span><span class="s2">(</span><span class="s0">buildOutputFolder, '</span><span class="s4">index.html</span><span class="s0">'</span><span class="s2">)</span><span class="s0">;</span>
      <span class="s3">const </span><span class="s0">customIndexData: string = </span><span class="s6">readFileSync</span><span class="s2">(</span><span class="s0">projectIndexHtml, { </span><span class="s2">encoding</span><span class="s0">: '</span><span class="s4">utf-8</span><span class="s0">' }</span><span class="s2">)</span><span class="s0">;</span>
      <span class="s3">const </span><span class="s0">generatedIndexData: string = </span><span class="s6">readFileSync</span><span class="s2">(</span><span class="s0">generatedIndexHtml, {</span>
        <span class="s2">encoding</span><span class="s0">: '</span><span class="s4">utf-8</span><span class="s0">'</span>
      <span class="s0">}</span><span class="s2">)</span><span class="s0">;</span>

      <span class="s3">const </span><span class="s0">customIndexRows = new </span><span class="s6">Set</span><span class="s2">(</span><span class="s0">customIndexData.</span><span class="s6">split</span><span class="s2">(</span><span class="s0">/</span><span class="s9">[</span><span class="s5">\r\n</span><span class="s9">]</span><span class="s0">/</span><span class="s2">)</span><span class="s0">.</span><span class="s6">filter</span><span class="s2">(</span><span class="s0">(row) </span><span class="s3">=&gt; </span><span class="s0">row.</span><span class="s6">trim</span><span class="s2">() </span><span class="s0">!== ''</span><span class="s2">))</span><span class="s0">;</span>
      <span class="s3">const </span><span class="s0">generatedIndexRows = generatedIndexData.</span><span class="s6">split</span><span class="s2">(</span><span class="s0">/</span><span class="s9">[</span><span class="s5">\r\n</span><span class="s9">]</span><span class="s0">/</span><span class="s2">)</span><span class="s0">.</span><span class="s6">filter</span><span class="s2">(</span><span class="s0">(row) </span><span class="s3">=&gt; </span><span class="s0">row.</span><span class="s6">trim</span><span class="s2">() </span><span class="s0">!== ''</span><span class="s2">)</span><span class="s0">;</span>

      <span class="s3">const </span><span class="s0">rowsGenerated: string</span><span class="s2">[] </span><span class="s0">= </span><span class="s2">[]</span><span class="s0">;</span>
      <span class="s0">generatedIndexRows.</span><span class="s6">forEach</span><span class="s2">(</span><span class="s0">(row) </span><span class="s3">=&gt; </span><span class="s0">{</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s0">!customIndexRows.</span><span class="s6">has</span><span class="s2">(</span><span class="s0">row</span><span class="s2">)) </span><span class="s0">{</span>
          <span class="s0">rowsGenerated.</span><span class="s6">push</span><span class="s2">(</span><span class="s0">row</span><span class="s2">)</span><span class="s0">;</span>
        <span class="s0">}</span>
      <span class="s0">}</span><span class="s2">)</span><span class="s0">;</span>

      <span class="s0">//</span><span class="s1">After dev-bundle build add used Flow frontend imports JsModule/JavaScript/CssImport</span>

      <span class="s3">const </span><span class="s6">parseImports </span><span class="s0">= (filename: string, result: Set&lt;string&gt;): void </span><span class="s3">=&gt; </span><span class="s0">{</span>
        <span class="s3">const </span><span class="s0">content: string = </span><span class="s6">readFileSync</span><span class="s2">(</span><span class="s0">filename, { </span><span class="s2">encoding</span><span class="s0">: '</span><span class="s4">utf-8</span><span class="s0">' }</span><span class="s2">)</span><span class="s0">;</span>
        <span class="s3">const </span><span class="s0">lines = content.</span><span class="s6">split</span><span class="s2">(</span><span class="s0">'</span><span class="s7">\n</span><span class="s0">'</span><span class="s2">)</span><span class="s0">;</span>
        <span class="s3">const </span><span class="s0">staticImports = lines</span>
          <span class="s0">.</span><span class="s6">filter</span><span class="s2">(</span><span class="s0">(line) </span><span class="s3">=&gt; </span><span class="s0">line.</span><span class="s6">startsWith</span><span class="s2">(</span><span class="s0">'</span><span class="s4">import </span><span class="s0">'</span><span class="s2">))</span>
          <span class="s0">.</span><span class="s6">map</span><span class="s2">(</span><span class="s0">(line) </span><span class="s3">=&gt; </span><span class="s0">line.</span><span class="s6">substring</span><span class="s2">(</span><span class="s0">line.</span><span class="s6">indexOf</span><span class="s2">(</span><span class="s0">&quot;</span><span class="s4">'</span><span class="s0">&quot;</span><span class="s2">) </span><span class="s0">+ </span><span class="s8">1</span><span class="s0">, line.</span><span class="s6">lastIndexOf</span><span class="s2">(</span><span class="s0">&quot;</span><span class="s4">'</span><span class="s0">&quot;</span><span class="s2">)))</span>
          <span class="s0">.</span><span class="s6">map</span><span class="s2">(</span><span class="s0">(line) </span><span class="s3">=&gt; </span><span class="s2">(</span><span class="s0">line.</span><span class="s6">includes</span><span class="s2">(</span><span class="s0">'</span><span class="s4">?</span><span class="s0">'</span><span class="s2">) </span><span class="s0">? line.</span><span class="s6">substring</span><span class="s2">(</span><span class="s8">0</span><span class="s0">, line.</span><span class="s6">lastIndexOf</span><span class="s2">(</span><span class="s0">'</span><span class="s4">?</span><span class="s0">'</span><span class="s2">)) </span><span class="s0">: line</span><span class="s2">))</span><span class="s0">;</span>
        <span class="s3">const </span><span class="s0">dynamicImports = lines</span>
          <span class="s0">.</span><span class="s6">filter</span><span class="s2">(</span><span class="s0">(line) </span><span class="s3">=&gt; </span><span class="s0">line.</span><span class="s6">includes</span><span class="s2">(</span><span class="s0">'</span><span class="s4">import(</span><span class="s0">'</span><span class="s2">))</span>
          <span class="s0">.</span><span class="s6">map</span><span class="s2">(</span><span class="s0">(line) </span><span class="s3">=&gt; </span><span class="s0">line.</span><span class="s6">replace</span><span class="s2">(</span><span class="s0">/</span><span class="s5">.</span><span class="s0">*</span><span class="s10">import</span><span class="s7">\(</span><span class="s0">/, ''</span><span class="s2">))</span>
          <span class="s0">.</span><span class="s6">map</span><span class="s2">(</span><span class="s0">(line) </span><span class="s3">=&gt; </span><span class="s0">line.</span><span class="s6">split</span><span class="s2">(</span><span class="s0">/</span><span class="s10">'</span><span class="s0">/</span><span class="s2">)[</span><span class="s8">1</span><span class="s2">])</span>
          <span class="s0">.</span><span class="s6">map</span><span class="s2">(</span><span class="s0">(line) </span><span class="s3">=&gt; </span><span class="s2">(</span><span class="s0">line.</span><span class="s6">includes</span><span class="s2">(</span><span class="s0">'</span><span class="s4">?</span><span class="s0">'</span><span class="s2">) </span><span class="s0">? line.</span><span class="s6">substring</span><span class="s2">(</span><span class="s8">0</span><span class="s0">, line.</span><span class="s6">lastIndexOf</span><span class="s2">(</span><span class="s0">'</span><span class="s4">?</span><span class="s0">'</span><span class="s2">)) </span><span class="s0">: line</span><span class="s2">))</span><span class="s0">;</span>

        <span class="s0">staticImports.</span><span class="s6">forEach</span><span class="s2">(</span><span class="s0">(staticImport) </span><span class="s3">=&gt; </span><span class="s0">result.</span><span class="s6">add</span><span class="s2">(</span><span class="s0">staticImport</span><span class="s2">))</span><span class="s0">;</span>

        <span class="s0">dynamicImports.</span><span class="s6">map</span><span class="s2">(</span><span class="s0">(dynamicImport) </span><span class="s3">=&gt; </span><span class="s0">{</span>
          <span class="s3">const </span><span class="s0">importedFile = path.</span><span class="s6">resolve</span><span class="s2">(</span><span class="s0">path.</span><span class="s6">dirname</span><span class="s2">(</span><span class="s0">filename</span><span class="s2">)</span><span class="s0">, dynamicImport</span><span class="s2">)</span><span class="s0">;</span>
          <span class="s6">parseImports</span><span class="s2">(</span><span class="s0">importedFile, result</span><span class="s2">)</span><span class="s0">;</span>
        <span class="s0">}</span><span class="s2">)</span><span class="s0">;</span>
      <span class="s0">};</span>

      <span class="s3">const </span><span class="s0">generatedImportsSet = new </span><span class="s6">Set</span><span class="s0">&lt;string&gt;</span><span class="s2">()</span><span class="s0">;</span>
      <span class="s6">parseImports</span><span class="s2">(</span>
        <span class="s0">path.</span><span class="s6">resolve</span><span class="s2">(</span><span class="s0">themeOptions.frontendGeneratedFolder, '</span><span class="s4">flow</span><span class="s0">', '</span><span class="s4">generated-flow-imports.js</span><span class="s0">'</span><span class="s2">)</span><span class="s0">,</span>
        <span class="s0">generatedImportsSet</span>
      <span class="s2">)</span><span class="s0">;</span>
      <span class="s3">const </span><span class="s0">generatedImports = Array.</span><span class="s6">from</span><span class="s2">(</span><span class="s0">generatedImportsSet</span><span class="s2">)</span><span class="s0">.</span><span class="s6">sort</span><span class="s2">()</span><span class="s0">;</span>

      <span class="s3">const </span><span class="s0">frontendFiles: Record&lt;string, string&gt; = {};</span>
      <span class="s0">frontendFiles</span><span class="s2">[</span><span class="s0">'</span><span class="s4">index.html</span><span class="s0">'</span><span class="s2">] </span><span class="s0">= </span><span class="s6">createHash</span><span class="s2">(</span><span class="s0">'</span><span class="s4">sha256</span><span class="s0">'</span><span class="s2">)</span><span class="s0">.</span><span class="s6">update</span><span class="s2">(</span><span class="s0">customIndexData.</span><span class="s6">replace</span><span class="s2">(</span><span class="s0">/</span><span class="s5">\r\n</span><span class="s0">/</span><span class="s3">g</span><span class="s0">, '</span><span class="s7">\n</span><span class="s0">'</span><span class="s2">)</span><span class="s0">, '</span><span class="s4">utf8</span><span class="s0">'</span><span class="s2">)</span><span class="s0">.</span><span class="s6">digest</span><span class="s2">(</span><span class="s0">'</span><span class="s4">hex</span><span class="s0">'</span><span class="s2">)</span><span class="s0">;</span>

      <span class="s3">const </span><span class="s0">projectFileExtensions = </span><span class="s2">[</span><span class="s0">'</span><span class="s4">.js</span><span class="s0">', '</span><span class="s4">.js.map</span><span class="s0">', '</span><span class="s4">.ts</span><span class="s0">', '</span><span class="s4">.ts.map</span><span class="s0">', '</span><span class="s4">.tsx</span><span class="s0">', '</span><span class="s4">.tsx.map</span><span class="s0">', '</span><span class="s4">.css</span><span class="s0">', '</span><span class="s4">.css.map</span><span class="s0">'</span><span class="s2">]</span><span class="s0">;</span>

      <span class="s3">const </span><span class="s6">isThemeComponentsResource </span><span class="s0">= (id: string) </span><span class="s3">=&gt;</span>
          <span class="s0">id.</span><span class="s6">startsWith</span><span class="s2">(</span><span class="s0">themeOptions.frontendGeneratedFolder.</span><span class="s6">replace</span><span class="s2">(</span><span class="s0">/</span><span class="s7">\\</span><span class="s0">/</span><span class="s3">g</span><span class="s0">, '</span><span class="s4">/</span><span class="s0">'</span><span class="s2">))</span>
              <span class="s0">&amp;&amp; id.</span><span class="s6">match</span><span class="s2">(</span><span class="s0">/</span><span class="s5">.</span><span class="s0">*</span><span class="s7">\/</span><span class="s10">jar-resources</span><span class="s7">\/</span><span class="s10">themes</span><span class="s7">\/</span><span class="s9">[^</span><span class="s7">\/</span><span class="s9">]</span><span class="s0">+</span><span class="s7">\/</span><span class="s10">components</span><span class="s7">\/</span><span class="s0">/</span><span class="s2">)</span><span class="s0">;</span>

      <span class="s3">const </span><span class="s6">isGeneratedWebComponentResource </span><span class="s0">= (id: string) </span><span class="s3">=&gt;</span>
          <span class="s0">id.</span><span class="s6">startsWith</span><span class="s2">(</span><span class="s0">themeOptions.frontendGeneratedFolder.</span><span class="s6">replace</span><span class="s2">(</span><span class="s0">/</span><span class="s7">\\</span><span class="s0">/</span><span class="s3">g</span><span class="s0">, '</span><span class="s4">/</span><span class="s0">'</span><span class="s2">))</span>
              <span class="s0">&amp;&amp; id.</span><span class="s6">match</span><span class="s2">(</span><span class="s0">/</span><span class="s5">.</span><span class="s0">*</span><span class="s7">\/</span><span class="s10">flow</span><span class="s7">\/</span><span class="s10">web-components</span><span class="s7">\/</span><span class="s0">/</span><span class="s2">)</span><span class="s0">;</span>

      <span class="s3">const </span><span class="s6">isFrontendResourceCollected </span><span class="s0">= (id: string) </span><span class="s3">=&gt;</span>
          <span class="s0">!id.</span><span class="s6">startsWith</span><span class="s2">(</span><span class="s0">themeOptions.frontendGeneratedFolder.</span><span class="s6">replace</span><span class="s2">(</span><span class="s0">/</span><span class="s7">\\</span><span class="s0">/</span><span class="s3">g</span><span class="s0">, '</span><span class="s4">/</span><span class="s0">'</span><span class="s2">))</span>
          <span class="s0">|| </span><span class="s6">isThemeComponentsResource</span><span class="s2">(</span><span class="s0">id</span><span class="s2">)</span>
          <span class="s0">|| </span><span class="s6">isGeneratedWebComponentResource</span><span class="s2">(</span><span class="s0">id</span><span class="s2">)</span><span class="s0">;</span>

      <span class="s0">// </span><span class="s1">collects project's frontend resources in frontend folder, excluding</span>
      <span class="s0">// </span><span class="s1">'generated' sub-folder, except for legacy shadow DOM stylesheets</span>
      <span class="s0">// </span><span class="s1">packaged in `theme/components/` folder</span>
      <span class="s0">// </span><span class="s1">and generated web component resources in `flow/web-components` folder.</span>
      <span class="s0">modules</span>
        <span class="s0">.</span><span class="s6">map</span><span class="s2">(</span><span class="s0">(id) </span><span class="s3">=&gt; </span><span class="s0">id.</span><span class="s6">replace</span><span class="s2">(</span><span class="s0">/</span><span class="s7">\\</span><span class="s0">/</span><span class="s3">g</span><span class="s0">, '</span><span class="s4">/</span><span class="s0">'</span><span class="s2">))</span>
        <span class="s0">.</span><span class="s6">filter</span><span class="s2">(</span><span class="s0">(id) </span><span class="s3">=&gt; </span><span class="s0">id.</span><span class="s6">startsWith</span><span class="s2">(</span><span class="s0">frontendFolder.</span><span class="s6">replace</span><span class="s2">(</span><span class="s0">/</span><span class="s7">\\</span><span class="s0">/</span><span class="s3">g</span><span class="s0">, '</span><span class="s4">/</span><span class="s0">'</span><span class="s2">)))</span>
        <span class="s0">.</span><span class="s6">filter</span><span class="s2">(</span><span class="s0">isFrontendResourceCollected</span><span class="s2">)</span>
        <span class="s0">.</span><span class="s6">map</span><span class="s2">(</span><span class="s0">(id) </span><span class="s3">=&gt; </span><span class="s0">id.</span><span class="s6">substring</span><span class="s2">(</span><span class="s0">frontendFolder.</span><span class="s2">length </span><span class="s0">+ </span><span class="s8">1</span><span class="s2">))</span>
        <span class="s0">.</span><span class="s6">map</span><span class="s2">(</span><span class="s0">(line: string) </span><span class="s3">=&gt; </span><span class="s2">(</span><span class="s0">line.</span><span class="s6">includes</span><span class="s2">(</span><span class="s0">'</span><span class="s4">?</span><span class="s0">'</span><span class="s2">) </span><span class="s0">? line.</span><span class="s6">substring</span><span class="s2">(</span><span class="s8">0</span><span class="s0">, line.</span><span class="s6">lastIndexOf</span><span class="s2">(</span><span class="s0">'</span><span class="s4">?</span><span class="s0">'</span><span class="s2">)) </span><span class="s0">: line</span><span class="s2">))</span>
        <span class="s0">.</span><span class="s6">forEach</span><span class="s2">(</span><span class="s0">(line: string) </span><span class="s3">=&gt; </span><span class="s0">{</span>
          <span class="s0">// </span><span class="s1">\r\n from windows made files may be used so change to \n</span>
          <span class="s3">const </span><span class="s0">filePath = path.</span><span class="s6">resolve</span><span class="s2">(</span><span class="s0">frontendFolder, line</span><span class="s2">)</span><span class="s0">;</span>
          <span class="s3">if </span><span class="s2">(</span><span class="s0">projectFileExtensions.</span><span class="s6">includes</span><span class="s2">(</span><span class="s0">path.</span><span class="s6">extname</span><span class="s2">(</span><span class="s0">filePath</span><span class="s2">))) </span><span class="s0">{</span>
            <span class="s3">const </span><span class="s0">fileBuffer = </span><span class="s6">readFileSync</span><span class="s2">(</span><span class="s0">filePath, { </span><span class="s2">encoding</span><span class="s0">: '</span><span class="s4">utf-8</span><span class="s0">' }</span><span class="s2">)</span><span class="s0">.</span><span class="s6">replace</span><span class="s2">(</span><span class="s0">/</span><span class="s5">\r\n</span><span class="s0">/</span><span class="s3">g</span><span class="s0">, '</span><span class="s7">\n</span><span class="s0">'</span><span class="s2">)</span><span class="s0">;</span>
            <span class="s0">frontendFiles</span><span class="s2">[</span><span class="s0">line</span><span class="s2">] </span><span class="s0">= </span><span class="s6">createHash</span><span class="s2">(</span><span class="s0">'</span><span class="s4">sha256</span><span class="s0">'</span><span class="s2">)</span><span class="s0">.</span><span class="s6">update</span><span class="s2">(</span><span class="s0">fileBuffer, '</span><span class="s4">utf8</span><span class="s0">'</span><span class="s2">)</span><span class="s0">.</span><span class="s6">digest</span><span class="s2">(</span><span class="s0">'</span><span class="s4">hex</span><span class="s0">'</span><span class="s2">)</span><span class="s0">;</span>
          <span class="s0">}</span>
        <span class="s0">}</span><span class="s2">)</span><span class="s0">;</span>

      <span class="s0">// </span><span class="s1">collects frontend resources from the JARs</span>
      <span class="s0">generatedImports</span>
        <span class="s0">.</span><span class="s6">filter</span><span class="s2">(</span><span class="s0">(line: string) </span><span class="s3">=&gt; </span><span class="s0">line.</span><span class="s6">includes</span><span class="s2">(</span><span class="s0">'</span><span class="s4">generated/jar-resources</span><span class="s0">'</span><span class="s2">))</span>
        <span class="s0">.</span><span class="s6">forEach</span><span class="s2">(</span><span class="s0">(line: string) </span><span class="s3">=&gt; </span><span class="s0">{</span>
          <span class="s3">let </span><span class="s0">filename = line.</span><span class="s6">substring</span><span class="s2">(</span><span class="s0">line.</span><span class="s6">indexOf</span><span class="s2">(</span><span class="s0">'</span><span class="s4">generated</span><span class="s0">'</span><span class="s2">))</span><span class="s0">;</span>
          <span class="s0">// </span><span class="s1">\r\n from windows made files may be used ro remove to be only \n</span>
          <span class="s3">const </span><span class="s0">fileBuffer = </span><span class="s6">readFileSync</span><span class="s2">(</span><span class="s0">path.</span><span class="s6">resolve</span><span class="s2">(</span><span class="s0">frontendFolder, filename</span><span class="s2">)</span><span class="s0">, { </span><span class="s2">encoding</span><span class="s0">: '</span><span class="s4">utf-8</span><span class="s0">' }</span><span class="s2">)</span><span class="s0">.</span><span class="s6">replace</span><span class="s2">(</span>
            <span class="s0">/</span><span class="s5">\r\n</span><span class="s0">/</span><span class="s3">g</span><span class="s0">,</span>
            <span class="s0">'</span><span class="s7">\n</span><span class="s0">'</span>
          <span class="s2">)</span><span class="s0">;</span>
          <span class="s3">const </span><span class="s0">hash = </span><span class="s6">createHash</span><span class="s2">(</span><span class="s0">'</span><span class="s4">sha256</span><span class="s0">'</span><span class="s2">)</span><span class="s0">.</span><span class="s6">update</span><span class="s2">(</span><span class="s0">fileBuffer, '</span><span class="s4">utf8</span><span class="s0">'</span><span class="s2">)</span><span class="s0">.</span><span class="s6">digest</span><span class="s2">(</span><span class="s0">'</span><span class="s4">hex</span><span class="s0">'</span><span class="s2">)</span><span class="s0">;</span>

          <span class="s3">const </span><span class="s0">fileKey = line.</span><span class="s6">substring</span><span class="s2">(</span><span class="s0">line.</span><span class="s6">indexOf</span><span class="s2">(</span><span class="s0">'</span><span class="s4">jar-resources/</span><span class="s0">'</span><span class="s2">) </span><span class="s0">+ </span><span class="s8">14</span><span class="s2">)</span><span class="s0">;</span>
          <span class="s0">frontendFiles</span><span class="s2">[</span><span class="s0">fileKey</span><span class="s2">] </span><span class="s0">= hash;</span>
        <span class="s0">}</span><span class="s2">)</span><span class="s0">;</span>
      <span class="s0">// </span><span class="s1">collects and hash rest of the Frontend resources excluding files in /generated/ and /themes/</span>
      <span class="s0">// </span><span class="s1">and files already in frontendFiles.</span>
      <span class="s3">let </span><span class="s0">frontendFolderAlias = &quot;</span><span class="s4">Frontend</span><span class="s0">&quot;;</span>
      <span class="s0">generatedImports</span>
        <span class="s0">.</span><span class="s6">filter</span><span class="s2">(</span><span class="s0">(line: string) </span><span class="s3">=&gt; </span><span class="s0">line.</span><span class="s6">startsWith</span><span class="s2">(</span><span class="s0">frontendFolderAlias + '</span><span class="s4">/</span><span class="s0">'</span><span class="s2">))</span>
        <span class="s0">.</span><span class="s6">filter</span><span class="s2">(</span><span class="s0">(line: string) </span><span class="s3">=&gt; </span><span class="s0">!line.</span><span class="s6">startsWith</span><span class="s2">(</span><span class="s0">frontendFolderAlias + '</span><span class="s4">/generated/</span><span class="s0">'</span><span class="s2">))</span>
        <span class="s0">.</span><span class="s6">filter</span><span class="s2">(</span><span class="s0">(line: string) </span><span class="s3">=&gt; </span><span class="s0">!line.</span><span class="s6">startsWith</span><span class="s2">(</span><span class="s0">frontendFolderAlias + '</span><span class="s4">/themes/</span><span class="s0">'</span><span class="s2">))</span>
        <span class="s0">.</span><span class="s6">map</span><span class="s2">(</span><span class="s0">(line) </span><span class="s3">=&gt; </span><span class="s0">line.</span><span class="s6">substring</span><span class="s2">(</span><span class="s0">frontendFolderAlias.</span><span class="s2">length </span><span class="s0">+ </span><span class="s8">1</span><span class="s2">))</span>
        <span class="s0">.</span><span class="s6">filter</span><span class="s2">(</span><span class="s0">(line: string) </span><span class="s3">=&gt; </span><span class="s0">!frontendFiles</span><span class="s2">[</span><span class="s0">line</span><span class="s2">])</span>
        <span class="s0">.</span><span class="s6">forEach</span><span class="s2">(</span><span class="s0">(line: string) </span><span class="s3">=&gt; </span><span class="s0">{</span>
          <span class="s3">const </span><span class="s0">filePath = path.</span><span class="s6">resolve</span><span class="s2">(</span><span class="s0">frontendFolder, line</span><span class="s2">)</span><span class="s0">;</span>
          <span class="s3">if </span><span class="s2">(</span><span class="s0">projectFileExtensions.</span><span class="s6">includes</span><span class="s2">(</span><span class="s0">path.</span><span class="s6">extname</span><span class="s2">(</span><span class="s0">filePath</span><span class="s2">)) </span><span class="s0">&amp;&amp; </span><span class="s6">existsSync</span><span class="s2">(</span><span class="s0">filePath</span><span class="s2">)) </span><span class="s0">{</span>
            <span class="s3">const </span><span class="s0">fileBuffer = </span><span class="s6">readFileSync</span><span class="s2">(</span><span class="s0">filePath, { </span><span class="s2">encoding</span><span class="s0">: '</span><span class="s4">utf-8</span><span class="s0">' }</span><span class="s2">)</span><span class="s0">.</span><span class="s6">replace</span><span class="s2">(</span><span class="s0">/</span><span class="s5">\r\n</span><span class="s0">/</span><span class="s3">g</span><span class="s0">, '</span><span class="s7">\n</span><span class="s0">'</span><span class="s2">)</span><span class="s0">;</span>
            <span class="s0">frontendFiles</span><span class="s2">[</span><span class="s0">line</span><span class="s2">] </span><span class="s0">= </span><span class="s6">createHash</span><span class="s2">(</span><span class="s0">'</span><span class="s4">sha256</span><span class="s0">'</span><span class="s2">)</span><span class="s0">.</span><span class="s6">update</span><span class="s2">(</span><span class="s0">fileBuffer, '</span><span class="s4">utf8</span><span class="s0">'</span><span class="s2">)</span><span class="s0">.</span><span class="s6">digest</span><span class="s2">(</span><span class="s0">'</span><span class="s4">hex</span><span class="s0">'</span><span class="s2">)</span><span class="s0">;</span>
          <span class="s0">}</span>
        <span class="s0">}</span><span class="s2">)</span><span class="s0">;</span>
      <span class="s0">// </span><span class="s1">If a index.ts exists hash it to be able to see if it changes.</span>
      <span class="s3">if </span><span class="s2">(</span><span class="s6">existsSync</span><span class="s2">(</span><span class="s0">path.</span><span class="s6">resolve</span><span class="s2">(</span><span class="s0">frontendFolder, '</span><span class="s4">index.ts</span><span class="s0">'</span><span class="s2">))) </span><span class="s0">{</span>
        <span class="s3">const </span><span class="s0">fileBuffer = </span><span class="s6">readFileSync</span><span class="s2">(</span><span class="s0">path.</span><span class="s6">resolve</span><span class="s2">(</span><span class="s0">frontendFolder, '</span><span class="s4">index.ts</span><span class="s0">'</span><span class="s2">)</span><span class="s0">, { </span><span class="s2">encoding</span><span class="s0">: '</span><span class="s4">utf-8</span><span class="s0">' }</span><span class="s2">)</span><span class="s0">.</span><span class="s6">replace</span><span class="s2">(</span>
          <span class="s0">/</span><span class="s5">\r\n</span><span class="s0">/</span><span class="s3">g</span><span class="s0">,</span>
          <span class="s0">'</span><span class="s7">\n</span><span class="s0">'</span>
        <span class="s2">)</span><span class="s0">;</span>
        <span class="s0">frontendFiles</span><span class="s2">[</span><span class="s0">`</span><span class="s4">index.ts</span><span class="s0">`</span><span class="s2">] </span><span class="s0">= </span><span class="s6">createHash</span><span class="s2">(</span><span class="s0">'</span><span class="s4">sha256</span><span class="s0">'</span><span class="s2">)</span><span class="s0">.</span><span class="s6">update</span><span class="s2">(</span><span class="s0">fileBuffer, '</span><span class="s4">utf8</span><span class="s0">'</span><span class="s2">)</span><span class="s0">.</span><span class="s6">digest</span><span class="s2">(</span><span class="s0">'</span><span class="s4">hex</span><span class="s0">'</span><span class="s2">)</span><span class="s0">;</span>
      <span class="s0">}</span>
      <span class="s3">if </span><span class="s2">(</span><span class="s0">hasCommercialBanner</span><span class="s2">) </span><span class="s0">{</span>
        <span class="s3">const </span><span class="s0">fileBuffer = </span><span class="s6">readFileSync</span><span class="s2">(</span><span class="s0">commercialBannerComponent, { </span><span class="s2">encoding</span><span class="s0">: '</span><span class="s4">utf-8</span><span class="s0">' }</span><span class="s2">)</span><span class="s0">.</span><span class="s6">replace</span><span class="s2">(</span><span class="s0">/</span><span class="s5">\r\n</span><span class="s0">/</span><span class="s3">g</span><span class="s0">, '</span><span class="s7">\n</span><span class="s0">'</span><span class="s2">)</span><span class="s0">;</span>
        <span class="s0">frontendFiles</span><span class="s2">[</span><span class="s0">settings.generatedFolder + '</span><span class="s4">/commercial-banner.js</span><span class="s0">'</span><span class="s2">] </span><span class="s0">= </span><span class="s6">createHash</span><span class="s2">(</span><span class="s0">'</span><span class="s4">sha256</span><span class="s0">'</span><span class="s2">)</span><span class="s0">.</span><span class="s6">update</span><span class="s2">(</span><span class="s0">fileBuffer, '</span><span class="s4">utf8</span><span class="s0">'</span><span class="s2">)</span><span class="s0">.</span><span class="s6">digest</span><span class="s2">(</span><span class="s0">'</span><span class="s4">hex</span><span class="s0">'</span><span class="s2">)</span><span class="s0">;</span>
      <span class="s0">}</span>

      <span class="s3">const </span><span class="s0">themeJsonContents: Record&lt;string, string&gt; = {};</span>
      <span class="s3">const </span><span class="s0">themesFolder = path.</span><span class="s6">resolve</span><span class="s2">(</span><span class="s0">jarResourcesFolder, '</span><span class="s4">themes</span><span class="s0">'</span><span class="s2">)</span><span class="s0">;</span>
      <span class="s3">if </span><span class="s2">(</span><span class="s6">existsSync</span><span class="s2">(</span><span class="s0">themesFolder</span><span class="s2">)) </span><span class="s0">{</span>
        <span class="s6">readdirSync</span><span class="s2">(</span><span class="s0">themesFolder</span><span class="s2">)</span><span class="s0">.</span><span class="s6">forEach</span><span class="s2">(</span><span class="s0">(themeFolder) </span><span class="s3">=&gt; </span><span class="s0">{</span>
          <span class="s3">const </span><span class="s0">themeJson = path.</span><span class="s6">resolve</span><span class="s2">(</span><span class="s0">themesFolder, themeFolder, '</span><span class="s4">theme.json</span><span class="s0">'</span><span class="s2">)</span><span class="s0">;</span>
          <span class="s3">if </span><span class="s2">(</span><span class="s6">existsSync</span><span class="s2">(</span><span class="s0">themeJson</span><span class="s2">)) </span><span class="s0">{</span>
            <span class="s0">themeJsonContents</span><span class="s2">[</span><span class="s0">path.</span><span class="s6">basename</span><span class="s2">(</span><span class="s0">themeFolder</span><span class="s2">)] </span><span class="s0">= </span><span class="s6">readFileSync</span><span class="s2">(</span><span class="s0">themeJson, { </span><span class="s2">encoding</span><span class="s0">: '</span><span class="s4">utf-8</span><span class="s0">' }</span><span class="s2">)</span><span class="s0">.</span><span class="s6">replace</span><span class="s2">(</span>
              <span class="s0">/</span><span class="s5">\r\n</span><span class="s0">/</span><span class="s3">g</span><span class="s0">,</span>
              <span class="s0">'</span><span class="s7">\n</span><span class="s0">'</span>
            <span class="s2">)</span><span class="s0">;</span>
          <span class="s0">}</span>
        <span class="s0">}</span><span class="s2">)</span><span class="s0">;</span>
      <span class="s0">}</span>

      <span class="s6">collectThemeJsonsInFrontend</span><span class="s2">(</span><span class="s0">themeJsonContents, settings.themeName</span><span class="s2">)</span><span class="s0">;</span>

      <span class="s3">let </span><span class="s0">webComponents: string</span><span class="s2">[] </span><span class="s0">= </span><span class="s2">[]</span><span class="s0">;</span>
      <span class="s3">if </span><span class="s2">(</span><span class="s0">webComponentTags</span><span class="s2">) </span><span class="s0">{</span>
        <span class="s0">webComponents = webComponentTags.</span><span class="s6">split</span><span class="s2">(</span><span class="s0">'</span><span class="s4">;</span><span class="s0">'</span><span class="s2">)</span><span class="s0">;</span>
      <span class="s0">}</span>

      <span class="s3">const </span><span class="s0">stats = {</span>
        <span class="s2">packageJsonDependencies</span><span class="s0">: projectPackageJson.dependencies,</span>
        <span class="s2">npmModules</span><span class="s0">: npmModuleAndVersion,</span>
        <span class="s2">bundleImports</span><span class="s0">: generatedImports,</span>
        <span class="s2">frontendHashes</span><span class="s0">: frontendFiles,</span>
        <span class="s2">themeJsonContents</span><span class="s0">: themeJsonContents,</span>
        <span class="s0">entryScripts,</span>
        <span class="s0">webComponents,</span>
        <span class="s2">cvdlModules</span><span class="s0">: cvdls,</span>
        <span class="s2">packageJsonHash</span><span class="s0">: projectPackageJson?.vaadin?.hash,</span>
        <span class="s2">indexHtmlGenerated</span><span class="s0">: rowsGenerated</span>
      <span class="s0">};</span>
      <span class="s6">writeFileSync</span><span class="s2">(</span><span class="s0">statsFile, JSON.</span><span class="s6">stringify</span><span class="s2">(</span><span class="s0">stats, </span><span class="s5">null</span><span class="s0">, </span><span class="s8">1</span><span class="s2">))</span><span class="s0">;</span>
    <span class="s0">}</span>
  <span class="s0">};</span>
<span class="s0">}</span>
<span class="s3">function </span><span class="s6">vaadinBundlesPlugin</span><span class="s0">(): PluginOption {</span>
  <span class="s3">type </span><span class="s0">ExportInfo =</span>
    <span class="s0">| string</span>
    <span class="s0">| {</span>
        <span class="s0">namespace?: string;</span>
        <span class="s0">source: string;</span>
      <span class="s0">};</span>

  <span class="s3">type </span><span class="s0">ExposeInfo = {</span>
    <span class="s0">exports: ExportInfo</span><span class="s2">[]</span><span class="s0">;</span>
  <span class="s0">};</span>

  <span class="s3">type </span><span class="s0">PackageInfo = {</span>
    <span class="s0">version: string;</span>
    <span class="s0">exposes: Record&lt;string, ExposeInfo&gt;;</span>
  <span class="s0">};</span>

  <span class="s3">type </span><span class="s0">BundleJson = {</span>
    <span class="s0">packages: Record&lt;string, PackageInfo&gt;;</span>
  <span class="s0">};</span>

  <span class="s3">const </span><span class="s0">disabledMessage = '</span><span class="s4">Vaadin component dependency bundles are disabled.</span><span class="s0">';</span>

  <span class="s3">const </span><span class="s0">modulesDirectory = nodeModulesFolder.</span><span class="s6">replace</span><span class="s2">(</span><span class="s0">/</span><span class="s7">\\</span><span class="s0">/</span><span class="s3">g</span><span class="s0">, '</span><span class="s4">/</span><span class="s0">'</span><span class="s2">)</span><span class="s0">;</span>

  <span class="s3">let </span><span class="s0">vaadinBundleJson: BundleJson;</span>

  <span class="s3">function </span><span class="s6">parseModuleId</span><span class="s0">(id: string): { packageName: string; modulePath: string } {</span>
    <span class="s3">const </span><span class="s0">[scope, scopedPackageName] = id.</span><span class="s6">split</span><span class="s2">(</span><span class="s0">'</span><span class="s4">/</span><span class="s0">', </span><span class="s8">3</span><span class="s2">)</span><span class="s0">;</span>
    <span class="s3">const </span><span class="s0">packageName = scope.</span><span class="s6">startsWith</span><span class="s2">(</span><span class="s0">'</span><span class="s4">@</span><span class="s0">'</span><span class="s2">) </span><span class="s0">? `${scope}</span><span class="s4">/</span><span class="s0">${scopedPackageName}` : scope;</span>
    <span class="s3">const </span><span class="s0">modulePath = `</span><span class="s4">.</span><span class="s0">${id.</span><span class="s6">substring</span><span class="s2">(</span><span class="s0">packageName.</span><span class="s2">length)</span><span class="s0">}`;</span>
    <span class="s3">return </span><span class="s0">{</span>
      <span class="s0">packageName,</span>
      <span class="s0">modulePath</span>
    <span class="s0">};</span>
  <span class="s0">}</span>

  <span class="s3">function </span><span class="s6">getExports</span><span class="s0">(id: string): string</span><span class="s2">[] </span><span class="s0">| undefined {</span>
    <span class="s3">const </span><span class="s0">{ packageName, modulePath } = </span><span class="s6">parseModuleId</span><span class="s2">(</span><span class="s0">id</span><span class="s2">)</span><span class="s0">;</span>
    <span class="s3">const </span><span class="s0">packageInfo = vaadinBundleJson.packages</span><span class="s2">[</span><span class="s0">packageName</span><span class="s2">]</span><span class="s0">;</span>

    <span class="s3">if </span><span class="s2">(</span><span class="s0">!packageInfo</span><span class="s2">) </span><span class="s3">return</span><span class="s0">;</span>

    <span class="s3">const </span><span class="s0">exposeInfo: ExposeInfo = packageInfo.exposes</span><span class="s2">[</span><span class="s0">modulePath</span><span class="s2">]</span><span class="s0">;</span>
    <span class="s3">if </span><span class="s2">(</span><span class="s0">!exposeInfo</span><span class="s2">) </span><span class="s3">return</span><span class="s0">;</span>

    <span class="s3">const </span><span class="s0">exportsSet = new </span><span class="s6">Set</span><span class="s0">&lt;string&gt;</span><span class="s2">()</span><span class="s0">;</span>
    <span class="s3">for </span><span class="s2">(</span><span class="s3">const </span><span class="s0">e of exposeInfo.exports</span><span class="s2">) </span><span class="s0">{</span>
      <span class="s3">if </span><span class="s2">(</span><span class="s0">typeof e === '</span><span class="s4">string</span><span class="s0">'</span><span class="s2">) </span><span class="s0">{</span>
        <span class="s0">exportsSet.</span><span class="s6">add</span><span class="s2">(</span><span class="s0">e</span><span class="s2">)</span><span class="s0">;</span>
      <span class="s0">} </span><span class="s3">else </span><span class="s0">{</span>
        <span class="s3">const </span><span class="s0">{ namespace, source } = e;</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s0">namespace</span><span class="s2">) </span><span class="s0">{</span>
          <span class="s0">exportsSet.</span><span class="s6">add</span><span class="s2">(</span><span class="s0">namespace</span><span class="s2">)</span><span class="s0">;</span>
        <span class="s0">} </span><span class="s3">else </span><span class="s0">{</span>
          <span class="s3">const </span><span class="s0">sourceExports = </span><span class="s6">getExports</span><span class="s2">(</span><span class="s0">source</span><span class="s2">)</span><span class="s0">;</span>
          <span class="s3">if </span><span class="s2">(</span><span class="s0">sourceExports</span><span class="s2">) </span><span class="s0">{</span>
            <span class="s0">sourceExports.</span><span class="s6">forEach</span><span class="s2">(</span><span class="s0">(e) </span><span class="s3">=&gt; </span><span class="s0">exportsSet.</span><span class="s6">add</span><span class="s2">(</span><span class="s0">e</span><span class="s2">))</span><span class="s0">;</span>
          <span class="s0">}</span>
        <span class="s0">}</span>
      <span class="s0">}</span>
    <span class="s0">}</span>
    <span class="s3">return </span><span class="s0">Array.</span><span class="s6">from</span><span class="s2">(</span><span class="s0">exportsSet</span><span class="s2">)</span><span class="s0">;</span>
  <span class="s0">}</span>

  <span class="s3">function </span><span class="s6">getExportBinding</span><span class="s0">(binding: string) {</span>
    <span class="s3">return </span><span class="s0">binding === '</span><span class="s4">default</span><span class="s0">' ? '</span><span class="s4">_default as default</span><span class="s0">' : binding;</span>
  <span class="s0">}</span>

  <span class="s3">function </span><span class="s6">getImportAssigment</span><span class="s0">(binding: string) {</span>
    <span class="s3">return </span><span class="s0">binding === '</span><span class="s4">default</span><span class="s0">' ? '</span><span class="s4">default: _default</span><span class="s0">' : binding;</span>
  <span class="s0">}</span>

  <span class="s3">return </span><span class="s0">{</span>
    <span class="s2">name</span><span class="s0">: '</span><span class="s4">vaadin:bundles</span><span class="s0">',</span>
    <span class="s2">enforce</span><span class="s0">: '</span><span class="s4">pre</span><span class="s0">',</span>
    <span class="s6">apply</span><span class="s0">(config, { command }) {</span>
      <span class="s3">if </span><span class="s2">(</span><span class="s0">command !== '</span><span class="s4">serve</span><span class="s0">'</span><span class="s2">) </span><span class="s3">return </span><span class="s5">false</span><span class="s0">;</span>

      <span class="s3">try </span><span class="s0">{</span>
        <span class="s3">const </span><span class="s0">vaadinBundleJsonPath = require.</span><span class="s6">resolve</span><span class="s2">(</span><span class="s0">'</span><span class="s4">@vaadin/bundles/vaadin-bundle.json</span><span class="s0">'</span><span class="s2">)</span><span class="s0">;</span>
        <span class="s0">vaadinBundleJson = JSON.</span><span class="s6">parse</span><span class="s2">(</span><span class="s6">readFileSync</span><span class="s2">(</span><span class="s0">vaadinBundleJsonPath, { </span><span class="s2">encoding</span><span class="s0">: '</span><span class="s4">utf8</span><span class="s0">' }</span><span class="s2">))</span><span class="s0">;</span>
      <span class="s0">} </span><span class="s3">catch </span><span class="s0">(e: unknown) {</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s0">typeof e === '</span><span class="s4">object</span><span class="s0">' &amp;&amp; </span><span class="s2">(</span><span class="s0">e </span><span class="s3">as </span><span class="s0">{ code: string }</span><span class="s2">)</span><span class="s0">.code === '</span><span class="s4">MODULE_NOT_FOUND</span><span class="s0">'</span><span class="s2">) </span><span class="s0">{</span>
          <span class="s0">vaadinBundleJson = { </span><span class="s2">packages</span><span class="s0">: {} };</span>
          <span class="s0">console.</span><span class="s6">info</span><span class="s2">(</span><span class="s0">`</span><span class="s4">@vaadin/bundles npm package is not found, </span><span class="s0">${disabledMessage}`</span><span class="s2">)</span><span class="s0">;</span>
          <span class="s3">return </span><span class="s5">false</span><span class="s0">;</span>
        <span class="s0">} </span><span class="s3">else </span><span class="s0">{</span>
          <span class="s3">throw </span><span class="s0">e;</span>
        <span class="s0">}</span>
      <span class="s0">}</span>

      <span class="s3">const </span><span class="s0">versionMismatches: Array&lt;{ name: string; bundledVersion: string; installedVersion: string }&gt; = </span><span class="s2">[]</span><span class="s0">;</span>
      <span class="s3">for </span><span class="s2">(</span><span class="s3">const </span><span class="s0">[name, packageInfo] of Object.</span><span class="s6">entries</span><span class="s2">(</span><span class="s0">vaadinBundleJson.packages</span><span class="s2">)) </span><span class="s0">{</span>
        <span class="s3">let </span><span class="s0">installedVersion: string | undefined = </span><span class="s5">undefined</span><span class="s0">;</span>
        <span class="s3">try </span><span class="s0">{</span>
          <span class="s3">const </span><span class="s0">{ version: bundledVersion } = packageInfo;</span>
          <span class="s3">const </span><span class="s0">installedPackageJsonFile = path.</span><span class="s6">resolve</span><span class="s2">(</span><span class="s0">modulesDirectory, name, '</span><span class="s4">package.json</span><span class="s0">'</span><span class="s2">)</span><span class="s0">;</span>
          <span class="s3">const </span><span class="s0">packageJson = JSON.</span><span class="s6">parse</span><span class="s2">(</span><span class="s6">readFileSync</span><span class="s2">(</span><span class="s0">installedPackageJsonFile, { </span><span class="s2">encoding</span><span class="s0">: '</span><span class="s4">utf8</span><span class="s0">' }</span><span class="s2">))</span><span class="s0">;</span>
          <span class="s0">installedVersion = packageJson.version;</span>
          <span class="s3">if </span><span class="s2">(</span><span class="s0">installedVersion &amp;&amp; installedVersion !== bundledVersion</span><span class="s2">) </span><span class="s0">{</span>
            <span class="s0">versionMismatches.</span><span class="s6">push</span><span class="s2">(</span><span class="s0">{</span>
              <span class="s0">name,</span>
              <span class="s0">bundledVersion,</span>
              <span class="s0">installedVersion</span>
            <span class="s0">}</span><span class="s2">)</span><span class="s0">;</span>
          <span class="s0">}</span>
        <span class="s0">} </span><span class="s3">catch </span><span class="s2">(</span><span class="s0">_</span><span class="s2">) </span><span class="s0">{</span>
          <span class="s0">// </span><span class="s1">ignore package not found</span>
        <span class="s0">}</span>
      <span class="s0">}</span>
      <span class="s3">if </span><span class="s2">(</span><span class="s0">versionMismatches.</span><span class="s2">length) </span><span class="s0">{</span>
        <span class="s0">console.</span><span class="s6">info</span><span class="s2">(</span><span class="s0">`</span><span class="s4">@vaadin/bundles has version mismatches with installed packages, </span><span class="s0">${disabledMessage}`</span><span class="s2">)</span><span class="s0">;</span>
        <span class="s0">console.</span><span class="s6">info</span><span class="s2">(</span><span class="s0">`</span><span class="s4">Packages with version mismatches: </span><span class="s0">${JSON.</span><span class="s6">stringify</span><span class="s2">(</span><span class="s0">versionMismatches, </span><span class="s5">undefined</span><span class="s0">, </span><span class="s8">2</span><span class="s2">)</span><span class="s0">}`</span><span class="s2">)</span><span class="s0">;</span>
        <span class="s0">vaadinBundleJson = { </span><span class="s2">packages</span><span class="s0">: {} };</span>
        <span class="s3">return </span><span class="s5">false</span><span class="s0">;</span>
      <span class="s0">}</span>

      <span class="s3">return </span><span class="s5">true</span><span class="s0">;</span>
    <span class="s0">},</span>
    <span class="s3">async </span><span class="s6">config</span><span class="s0">(config) {</span>
      <span class="s3">return </span><span class="s6">mergeConfig</span><span class="s2">(</span>
        <span class="s0">{</span>
          <span class="s2">optimizeDeps</span><span class="s0">: {</span>
            <span class="s2">exclude</span><span class="s0">: </span><span class="s2">[</span>
              <span class="s0">// </span><span class="s1">Vaadin bundle</span>
              <span class="s0">'</span><span class="s4">@vaadin/bundles</span><span class="s0">',</span>
              <span class="s0">...Object.</span><span class="s6">keys</span><span class="s2">(</span><span class="s0">vaadinBundleJson.packages</span><span class="s2">)</span><span class="s0">,</span>
              <span class="s0">'</span><span class="s4">@vaadin/vaadin-material-styles</span><span class="s0">'</span>
            <span class="s2">]</span>
          <span class="s0">}</span>
        <span class="s0">},</span>
        <span class="s0">config</span>
      <span class="s2">)</span><span class="s0">;</span>
    <span class="s0">},</span>
    <span class="s6">load</span><span class="s0">(rawId) {</span>
      <span class="s3">const </span><span class="s0">[path, params] = rawId.</span><span class="s6">split</span><span class="s2">(</span><span class="s0">'</span><span class="s4">?</span><span class="s0">'</span><span class="s2">)</span><span class="s0">;</span>
      <span class="s3">if </span><span class="s2">(</span><span class="s0">!path.</span><span class="s6">startsWith</span><span class="s2">(</span><span class="s0">modulesDirectory</span><span class="s2">)) </span><span class="s3">return</span><span class="s0">;</span>

      <span class="s3">const </span><span class="s0">id = path.</span><span class="s6">substring</span><span class="s2">(</span><span class="s0">modulesDirectory.</span><span class="s2">length </span><span class="s0">+ </span><span class="s8">1</span><span class="s2">)</span><span class="s0">;</span>
      <span class="s3">const </span><span class="s0">bindings = </span><span class="s6">getExports</span><span class="s2">(</span><span class="s0">id</span><span class="s2">)</span><span class="s0">;</span>
      <span class="s3">if </span><span class="s2">(</span><span class="s0">bindings === </span><span class="s5">undefined</span><span class="s2">) </span><span class="s3">return</span><span class="s0">;</span>

      <span class="s3">const </span><span class="s0">cacheSuffix = params ? `</span><span class="s4">?</span><span class="s0">${params}` : '';</span>
      <span class="s3">const </span><span class="s0">bundlePath = `</span><span class="s4">@vaadin/bundles/vaadin.js</span><span class="s0">${cacheSuffix}`;</span>

      <span class="s3">return </span><span class="s0">`</span><span class="s4">import { init as VaadinBundleInit, get as VaadinBundleGet } from '</span><span class="s0">${bundlePath}</span><span class="s4">'; 
await VaadinBundleInit('default'); 
const { </span><span class="s0">${bindings.</span><span class="s6">map</span><span class="s2">(</span><span class="s0">getImportAssigment</span><span class="s2">)</span><span class="s0">.</span><span class="s6">join</span><span class="s2">(</span><span class="s0">'</span><span class="s4">, </span><span class="s0">'</span><span class="s2">)</span><span class="s0">} </span><span class="s4">} = (await VaadinBundleGet('./node_modules/</span><span class="s0">${id}</span><span class="s4">'))(); 
export { </span><span class="s0">${bindings.</span><span class="s6">map</span><span class="s2">(</span><span class="s0">getExportBinding</span><span class="s2">)</span><span class="s0">.</span><span class="s6">join</span><span class="s2">(</span><span class="s0">'</span><span class="s4">, </span><span class="s0">'</span><span class="s2">)</span><span class="s0">} </span><span class="s4">};</span><span class="s0">`;</span>
    <span class="s0">}</span>
  <span class="s0">};</span>
<span class="s0">}</span>

<span class="s3">function </span><span class="s6">themePlugin</span><span class="s0">(opts: { devMode: boolean }): PluginOption {</span>
  <span class="s3">const </span><span class="s0">fullThemeOptions = { ...themeOptions, </span><span class="s2">devMode</span><span class="s0">: opts.devMode };</span>
  <span class="s3">return </span><span class="s0">{</span>
    <span class="s2">name</span><span class="s0">: '</span><span class="s4">vaadin:theme</span><span class="s0">',</span>
    <span class="s6">config</span><span class="s0">() {</span>
      <span class="s6">processThemeResources</span><span class="s2">(</span><span class="s0">fullThemeOptions, console</span><span class="s2">)</span><span class="s0">;</span>
    <span class="s0">},</span>
    <span class="s6">configureServer</span><span class="s0">(server) {</span>
      <span class="s3">function </span><span class="s6">handleThemeFileCreateDelete</span><span class="s0">(themeFile: string, stats?: Stats) {</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s0">themeFile.</span><span class="s6">startsWith</span><span class="s2">(</span><span class="s0">themeFolder</span><span class="s2">)) </span><span class="s0">{</span>
          <span class="s3">const </span><span class="s0">changed = path.</span><span class="s6">relative</span><span class="s2">(</span><span class="s0">themeFolder, themeFile</span><span class="s2">)</span><span class="s0">;</span>
          <span class="s0">console.</span><span class="s6">debug</span><span class="s2">(</span><span class="s0">'</span><span class="s4">Theme file </span><span class="s0">' + </span><span class="s2">(</span><span class="s0">!!stats ? '</span><span class="s4">created</span><span class="s0">' : '</span><span class="s4">deleted</span><span class="s0">'</span><span class="s2">)</span><span class="s0">, changed</span><span class="s2">)</span><span class="s0">;</span>
          <span class="s6">processThemeResources</span><span class="s2">(</span><span class="s0">fullThemeOptions, console</span><span class="s2">)</span><span class="s0">;</span>
        <span class="s0">}</span>
      <span class="s0">}</span>
      <span class="s0">server.watcher.</span><span class="s6">on</span><span class="s2">(</span><span class="s0">'</span><span class="s4">add</span><span class="s0">', handleThemeFileCreateDelete</span><span class="s2">)</span><span class="s0">;</span>
      <span class="s0">server.watcher.</span><span class="s6">on</span><span class="s2">(</span><span class="s0">'</span><span class="s4">unlink</span><span class="s0">', handleThemeFileCreateDelete</span><span class="s2">)</span><span class="s0">;</span>
    <span class="s0">},</span>
    <span class="s6">handleHotUpdate</span><span class="s0">(context) {</span>
      <span class="s3">const </span><span class="s0">contextPath = path.</span><span class="s6">resolve</span><span class="s2">(</span><span class="s0">context.file</span><span class="s2">)</span><span class="s0">;</span>
      <span class="s3">const </span><span class="s0">themePath = path.</span><span class="s6">resolve</span><span class="s2">(</span><span class="s0">themeFolder</span><span class="s2">)</span><span class="s0">;</span>
      <span class="s3">if </span><span class="s2">(</span><span class="s0">contextPath.</span><span class="s6">startsWith</span><span class="s2">(</span><span class="s0">themePath</span><span class="s2">)) </span><span class="s0">{</span>
        <span class="s3">const </span><span class="s0">changed = path.</span><span class="s6">relative</span><span class="s2">(</span><span class="s0">themePath, contextPath</span><span class="s2">)</span><span class="s0">;</span>

        <span class="s0">console.</span><span class="s6">debug</span><span class="s2">(</span><span class="s0">'</span><span class="s4">Theme file changed</span><span class="s0">', changed</span><span class="s2">)</span><span class="s0">;</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s0">changed.</span><span class="s6">startsWith</span><span class="s2">(</span><span class="s0">settings.themeName</span><span class="s2">)) </span><span class="s0">{</span>
          <span class="s6">processThemeResources</span><span class="s2">(</span><span class="s0">fullThemeOptions, console</span><span class="s2">)</span><span class="s0">;</span>
        <span class="s0">}</span>
      <span class="s0">}</span>
    <span class="s0">},</span>
    <span class="s3">async </span><span class="s6">resolveId</span><span class="s0">(id, importer) {</span>
      <span class="s0">// </span><span class="s1">force theme generation if generated theme sources does not yet exist</span>
      <span class="s0">// </span><span class="s1">this may happen for example during Java hot reload when updating</span>
      <span class="s0">// </span><span class="s1">@Theme annotation value</span>
      <span class="s3">if </span><span class="s2">(</span>
        <span class="s0">path.</span><span class="s6">resolve</span><span class="s2">(</span><span class="s0">themeOptions.frontendGeneratedFolder, '</span><span class="s4">theme.js</span><span class="s0">'</span><span class="s2">) </span><span class="s0">=== importer &amp;&amp;</span>
        <span class="s0">!</span><span class="s6">existsSync</span><span class="s2">(</span><span class="s0">path.</span><span class="s6">resolve</span><span class="s2">(</span><span class="s0">themeOptions.frontendGeneratedFolder, id</span><span class="s2">))</span>
      <span class="s2">) </span><span class="s0">{</span>
        <span class="s0">console.</span><span class="s6">debug</span><span class="s2">(</span><span class="s0">'</span><span class="s4">Generate theme file </span><span class="s0">' + id + ' </span><span class="s4">not existing. Processing theme resource</span><span class="s0">'</span><span class="s2">)</span><span class="s0">;</span>
        <span class="s6">processThemeResources</span><span class="s2">(</span><span class="s0">fullThemeOptions, console</span><span class="s2">)</span><span class="s0">;</span>
        <span class="s3">return</span><span class="s0">;</span>
      <span class="s0">}</span>
      <span class="s3">if </span><span class="s2">(</span><span class="s0">!id.</span><span class="s6">startsWith</span><span class="s2">(</span><span class="s0">settings.themeFolder</span><span class="s2">)) </span><span class="s0">{</span>
        <span class="s3">return</span><span class="s0">;</span>
      <span class="s0">}</span>
      <span class="s3">for </span><span class="s2">(</span><span class="s3">const </span><span class="s0">location of </span><span class="s2">[</span><span class="s0">themeResourceFolder, frontendFolder</span><span class="s2">]) </span><span class="s0">{</span>
        <span class="s3">const </span><span class="s0">result = </span><span class="s3">await </span><span class="s0">this.</span><span class="s6">resolve</span><span class="s2">(</span><span class="s0">path.</span><span class="s6">resolve</span><span class="s2">(</span><span class="s0">location, id</span><span class="s2">))</span><span class="s0">;</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s0">result</span><span class="s2">) </span><span class="s0">{</span>
          <span class="s3">return </span><span class="s0">result;</span>
        <span class="s0">}</span>
      <span class="s0">}</span>
    <span class="s0">},</span>
    <span class="s3">async </span><span class="s6">transform</span><span class="s0">(raw, id, options) {</span>
      <span class="s0">// </span><span class="s1">rewrite urls for the application theme css files</span>
      <span class="s3">const </span><span class="s0">[bareId, query] = id.</span><span class="s6">split</span><span class="s2">(</span><span class="s0">'</span><span class="s4">?</span><span class="s0">'</span><span class="s2">)</span><span class="s0">;</span>
      <span class="s3">if </span><span class="s2">(</span>
        <span class="s2">(</span><span class="s0">!bareId?.</span><span class="s6">startsWith</span><span class="s2">(</span><span class="s0">themeFolder</span><span class="s2">) </span><span class="s0">&amp;&amp; !bareId?.</span><span class="s6">startsWith</span><span class="s2">(</span><span class="s0">themeOptions.themeResourceFolder</span><span class="s2">)) </span><span class="s0">||</span>
        <span class="s0">!bareId?.</span><span class="s6">endsWith</span><span class="s2">(</span><span class="s0">'</span><span class="s4">.css</span><span class="s0">'</span><span class="s2">)</span>
      <span class="s2">) </span><span class="s0">{</span>
        <span class="s3">return</span><span class="s0">;</span>
      <span class="s0">}</span>
      <span class="s3">const </span><span class="s0">resourceThemeFolder = bareId.</span><span class="s6">startsWith</span><span class="s2">(</span><span class="s0">themeFolder</span><span class="s2">) </span><span class="s0">? themeFolder : themeOptions.themeResourceFolder;</span>
      <span class="s3">const </span><span class="s0">[themeName] =  bareId.</span><span class="s6">substring</span><span class="s2">(</span><span class="s0">resourceThemeFolder.</span><span class="s2">length </span><span class="s0">+ </span><span class="s8">1</span><span class="s2">)</span><span class="s0">.</span><span class="s6">split</span><span class="s2">(</span><span class="s0">'</span><span class="s4">/</span><span class="s0">'</span><span class="s2">)</span><span class="s0">;</span>
      <span class="s3">return </span><span class="s6">rewriteCssUrls</span><span class="s2">(</span><span class="s0">raw, path.</span><span class="s6">dirname</span><span class="s2">(</span><span class="s0">bareId</span><span class="s2">)</span><span class="s0">, path.</span><span class="s6">resolve</span><span class="s2">(</span><span class="s0">resourceThemeFolder, themeName</span><span class="s2">)</span><span class="s0">, console, opts</span><span class="s2">)</span><span class="s0">;</span>
    <span class="s0">}</span>
  <span class="s0">};</span>
<span class="s0">}</span>

<span class="s3">function </span><span class="s6">runWatchDog</span><span class="s0">(watchDogPort: number, watchDogHost: string | undefined) {</span>
  <span class="s3">const </span><span class="s0">client = new net.</span><span class="s6">Socket</span><span class="s2">()</span><span class="s0">;</span>
  <span class="s0">client.</span><span class="s6">setEncoding</span><span class="s2">(</span><span class="s0">'</span><span class="s4">utf8</span><span class="s0">'</span><span class="s2">)</span><span class="s0">;</span>
  <span class="s0">client.</span><span class="s6">on</span><span class="s2">(</span><span class="s0">'</span><span class="s4">error</span><span class="s0">', </span><span class="s3">function </span><span class="s0">(err) {</span>
    <span class="s0">console.</span><span class="s6">log</span><span class="s2">(</span><span class="s0">'</span><span class="s4">Watchdog connection error. Terminating vite process...</span><span class="s0">', err</span><span class="s2">)</span><span class="s0">;</span>
    <span class="s0">client.</span><span class="s6">destroy</span><span class="s2">()</span><span class="s0">;</span>
    <span class="s0">process.</span><span class="s6">exit</span><span class="s2">(</span><span class="s8">0</span><span class="s2">)</span><span class="s0">;</span>
  <span class="s0">}</span><span class="s2">)</span><span class="s0">;</span>
  <span class="s0">client.</span><span class="s6">on</span><span class="s2">(</span><span class="s0">'</span><span class="s4">close</span><span class="s0">', </span><span class="s3">function </span><span class="s0">() {</span>
    <span class="s0">client.</span><span class="s6">destroy</span><span class="s2">()</span><span class="s0">;</span>
    <span class="s6">runWatchDog</span><span class="s2">(</span><span class="s0">watchDogPort, watchDogHost</span><span class="s2">)</span><span class="s0">;</span>
  <span class="s0">}</span><span class="s2">)</span><span class="s0">;</span>

  <span class="s0">client.</span><span class="s6">connect</span><span class="s2">(</span><span class="s0">watchDogPort, watchDogHost || '</span><span class="s4">localhost</span><span class="s0">'</span><span class="s2">)</span><span class="s0">;</span>
<span class="s0">}</span>

<span class="s3">const </span><span class="s0">allowedFrontendFolders = </span><span class="s2">[</span><span class="s0">frontendFolder, nodeModulesFolder</span><span class="s2">]</span><span class="s0">;</span>

<span class="s3">function </span><span class="s6">showRecompileReason</span><span class="s0">(): PluginOption {</span>
  <span class="s3">return </span><span class="s0">{</span>
    <span class="s2">name</span><span class="s0">: '</span><span class="s4">vaadin:why-you-compile</span><span class="s0">',</span>
    <span class="s6">handleHotUpdate</span><span class="s0">(context) {</span>
      <span class="s0">console.</span><span class="s6">log</span><span class="s2">(</span><span class="s0">'</span><span class="s4">Recompiling because</span><span class="s0">', context.file, '</span><span class="s4">changed</span><span class="s0">'</span><span class="s2">)</span><span class="s0">;</span>
    <span class="s0">}</span>
  <span class="s0">};</span>
<span class="s0">}</span>

<span class="s3">const </span><span class="s0">DEV_MODE_START_REGEXP = /</span><span class="s7">\/\*</span><span class="s9">[</span><span class="s7">\*</span><span class="s5">!</span><span class="s9">]</span><span class="s5">\s</span><span class="s0">+</span><span class="s10">vaadin-dev-mode:start</span><span class="s0">/;</span>
<span class="s3">const </span><span class="s0">DEV_MODE_CODE_REGEXP = /</span><span class="s7">\/\*</span><span class="s9">[</span><span class="s7">\*</span><span class="s5">!</span><span class="s9">]</span><span class="s5">\s</span><span class="s0">+</span><span class="s10">vaadin-dev-mode:start</span><span class="s0">(</span><span class="s9">[</span><span class="s5">\s\S</span><span class="s9">]</span><span class="s0">*)</span><span class="s10">vaadin-dev-mode:end</span><span class="s5">\s</span><span class="s0">+</span><span class="s7">\*\*\/</span><span class="s0">/</span><span class="s3">i</span><span class="s0">;</span>

<span class="s3">function </span><span class="s6">preserveUsageStats</span><span class="s0">() {</span>
  <span class="s3">return </span><span class="s0">{</span>
    <span class="s2">name</span><span class="s0">: '</span><span class="s4">vaadin:preserve-usage-stats</span><span class="s0">',</span>

    <span class="s6">transform</span><span class="s0">(src: string, id: string) {</span>
      <span class="s3">if </span><span class="s2">(</span><span class="s0">id.</span><span class="s6">includes</span><span class="s2">(</span><span class="s0">'</span><span class="s4">vaadin-usage-statistics</span><span class="s0">'</span><span class="s2">)) </span><span class="s0">{</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s0">src.</span><span class="s6">includes</span><span class="s2">(</span><span class="s0">'</span><span class="s4">vaadin-dev-mode:start</span><span class="s0">'</span><span class="s2">)) </span><span class="s0">{</span>
          <span class="s3">const </span><span class="s0">newSrc = src.</span><span class="s6">replace</span><span class="s2">(</span><span class="s0">DEV_MODE_START_REGEXP, '</span><span class="s4">/*! vaadin-dev-mode:start</span><span class="s0">'</span><span class="s2">)</span><span class="s0">;</span>
          <span class="s3">if </span><span class="s2">(</span><span class="s0">newSrc === src</span><span class="s2">) </span><span class="s0">{</span>
            <span class="s0">console.</span><span class="s6">error</span><span class="s2">(</span><span class="s0">'</span><span class="s4">Comment replacement failed to change anything</span><span class="s0">'</span><span class="s2">)</span><span class="s0">;</span>
          <span class="s0">} </span><span class="s3">else if </span><span class="s2">(</span><span class="s0">!newSrc.</span><span class="s6">match</span><span class="s2">(</span><span class="s0">DEV_MODE_CODE_REGEXP</span><span class="s2">)) </span><span class="s0">{</span>
            <span class="s0">console.</span><span class="s6">error</span><span class="s2">(</span><span class="s0">'</span><span class="s4">New comment fails to match original regexp</span><span class="s0">'</span><span class="s2">)</span><span class="s0">;</span>
          <span class="s0">} </span><span class="s3">else </span><span class="s0">{</span>
            <span class="s3">return </span><span class="s0">{ </span><span class="s2">code</span><span class="s0">: newSrc };</span>
          <span class="s0">}</span>
        <span class="s0">}</span>
      <span class="s0">}</span>

      <span class="s3">return </span><span class="s0">{ </span><span class="s2">code</span><span class="s0">: src };</span>
    <span class="s0">}</span>
  <span class="s0">};</span>
<span class="s0">}</span>

<span class="s3">export const </span><span class="s6">vaadinConfig</span><span class="s0">: UserConfigFn = (env) </span><span class="s3">=&gt; </span><span class="s0">{</span>
  <span class="s3">const </span><span class="s0">devMode = env.mode === '</span><span class="s4">development</span><span class="s0">';</span>
  <span class="s3">const </span><span class="s0">productionMode = !devMode &amp;&amp; !devBundle</span>
  <span class="s3">const </span><span class="s0">commercialBanner = productionMode &amp;&amp; hasCommercialBanner;</span>

  <span class="s3">if </span><span class="s2">(</span><span class="s0">devMode &amp;&amp; process.env.watchDogPort</span><span class="s2">) </span><span class="s0">{</span>
    <span class="s0">// </span><span class="s1">Open a connection with the Java dev-mode handler in order to finish</span>
    <span class="s0">// </span><span class="s1">vite when it exits or crashes.</span>
    <span class="s6">runWatchDog</span><span class="s2">(</span><span class="s6">parseInt</span><span class="s2">(</span><span class="s0">process.env.watchDogPort</span><span class="s2">)</span><span class="s0">, process.env.watchDogHost</span><span class="s2">)</span><span class="s0">;</span>
  <span class="s0">}</span>

  <span class="s3">return </span><span class="s0">{</span>
    <span class="s2">root</span><span class="s0">: frontendFolder,</span>
    <span class="s2">base</span><span class="s0">: '',</span>
    <span class="s2">publicDir</span><span class="s0">: </span><span class="s5">false</span><span class="s0">,</span>
    <span class="s2">resolve</span><span class="s0">: {</span>
      <span class="s2">alias</span><span class="s0">: {</span>
        <span class="s0">'</span><span class="s4">@vaadin/flow-frontend</span><span class="s0">': jarResourcesFolder,</span>
        <span class="s2">Frontend</span><span class="s0">: frontendFolder</span>
      <span class="s0">},</span>
      <span class="s2">preserveSymlinks</span><span class="s0">: </span><span class="s5">true</span>
    <span class="s0">},</span>
    <span class="s2">define</span><span class="s0">: {</span>
      <span class="s2">OFFLINE_PATH</span><span class="s0">: settings.offlinePath,</span>
      <span class="s2">VITE_ENABLED</span><span class="s0">: '</span><span class="s4">true</span><span class="s0">'</span>
    <span class="s0">},</span>
    <span class="s2">server</span><span class="s0">: {</span>
      <span class="s2">host</span><span class="s0">: '</span><span class="s4">127.0.0.1</span><span class="s0">',</span>
      <span class="s2">strictPort</span><span class="s0">: </span><span class="s5">true</span><span class="s0">,</span>
      <span class="s2">fs</span><span class="s0">: {</span>
        <span class="s2">allow</span><span class="s0">: allowedFrontendFolders</span>
      <span class="s0">}</span>
    <span class="s0">},</span>
    <span class="s2">build</span><span class="s0">: {</span>
      <span class="s2">minify</span><span class="s0">: productionMode,</span>
      <span class="s2">outDir</span><span class="s0">: buildOutputFolder,</span>
      <span class="s2">emptyOutDir</span><span class="s0">: devBundle,</span>
      <span class="s2">assetsDir</span><span class="s0">: '</span><span class="s4">VAADIN/build</span><span class="s0">',</span>
      <span class="s0">target,</span>
      <span class="s2">rollupOptions</span><span class="s0">: {</span>
        <span class="s2">input</span><span class="s0">: {</span>
          <span class="s2">indexhtml</span><span class="s0">: projectIndexHtml,</span>

          <span class="s0">...</span><span class="s2">(</span><span class="s0">hasExportedWebComponents ? { </span><span class="s2">webcomponenthtml</span><span class="s0">: path.</span><span class="s6">resolve</span><span class="s2">(</span><span class="s0">frontendFolder, '</span><span class="s4">web-component.html</span><span class="s0">'</span><span class="s2">) </span><span class="s0">} : {}</span><span class="s2">)</span>
        <span class="s0">},</span>
        <span class="s2">output</span><span class="s0">: {</span>
          <span class="s0">// </span><span class="s1">Workaround to enable dynamic imports with top-level await for</span>
          <span class="s0">// </span><span class="s1">commonjs modules, such as &quot;atmosphere.js&quot; in Hilla. Extracting</span>
          <span class="s0">// </span><span class="s1">Rollup's commonjs helpers into separate manual chunk avoids</span>
          <span class="s0">// </span><span class="s1">circular dependencies in this case. Caused</span>
          <span class="s0">//   </span><span class="s1">- https://github.com/vitejs/vite/issues/10995</span>
          <span class="s0">//   </span><span class="s1">- https://github.com/rollup/rollup/issues/5884</span>
          <span class="s0">//   </span><span class="s1">- https://github.com/vitejs/vite/issues/19695</span>
          <span class="s0">//   </span><span class="s1">- https://github.com/vitejs/vite/issues/12209</span>
          <span class="s6">manualChunks</span><span class="s0">: (id: string) </span><span class="s3">=&gt; </span><span class="s0">id.</span><span class="s6">startsWith</span><span class="s2">(</span><span class="s0">'</span><span class="s7">\0</span><span class="s4">commonjsHelpers.js</span><span class="s0">'</span><span class="s2">) </span><span class="s0">? '</span><span class="s4">commonjsHelpers</span><span class="s0">' : </span><span class="s5">null</span>
        <span class="s0">},</span>
        <span class="s6">onwarn</span><span class="s0">: (warning: rollup.RollupLog, defaultHandler: rollup.LoggingFunction) </span><span class="s3">=&gt; </span><span class="s0">{</span>
          <span class="s3">const </span><span class="s0">ignoreEvalWarning = </span><span class="s2">[</span>
            <span class="s0">'</span><span class="s4">generated/jar-resources/FlowClient.js</span><span class="s0">',</span>
            <span class="s0">'</span><span class="s4">generated/jar-resources/vaadin-spreadsheet/spreadsheet-export.js</span><span class="s0">',</span>
            <span class="s0">'</span><span class="s4">@vaadin/charts/src/helpers.js</span><span class="s0">'</span>
          <span class="s2">]</span><span class="s0">;</span>
          <span class="s3">if </span><span class="s2">(</span><span class="s0">warning.code === '</span><span class="s4">EVAL</span><span class="s0">' &amp;&amp; warning.id &amp;&amp; !!ignoreEvalWarning.</span><span class="s6">find</span><span class="s2">(</span><span class="s0">(id) </span><span class="s3">=&gt; </span><span class="s0">warning.id?.</span><span class="s6">endsWith</span><span class="s2">(</span><span class="s0">id</span><span class="s2">))) </span><span class="s0">{</span>
            <span class="s3">return</span><span class="s0">;</span>
          <span class="s0">}</span>
          <span class="s6">defaultHandler</span><span class="s2">(</span><span class="s0">warning</span><span class="s2">)</span><span class="s0">;</span>
        <span class="s0">}</span>
      <span class="s0">}</span>
    <span class="s0">},</span>
    <span class="s2">optimizeDeps</span><span class="s0">: {</span>
      <span class="s2">esbuildOptions</span><span class="s0">: {</span>
        <span class="s0">target,</span>
      <span class="s0">},</span>
      <span class="s2">entries</span><span class="s0">: </span><span class="s2">[</span>
        <span class="s0">// </span><span class="s1">Pre-scan entrypoints in Vite to avoid reloading on first open</span>
        <span class="s0">'</span><span class="s4">generated/vaadin.ts</span><span class="s0">'</span>
      <span class="s2">]</span><span class="s0">,</span>
      <span class="s2">exclude</span><span class="s0">: </span><span class="s2">[</span>
        <span class="s0">'</span><span class="s4">@vaadin/router</span><span class="s0">',</span>
        <span class="s0">'</span><span class="s4">@vaadin/vaadin-license-checker</span><span class="s0">',</span>
        <span class="s0">'</span><span class="s4">@vaadin/vaadin-usage-statistics</span><span class="s0">',</span>
        <span class="s0">'</span><span class="s4">workbox-core</span><span class="s0">',</span>
        <span class="s0">'</span><span class="s4">workbox-precaching</span><span class="s0">',</span>
        <span class="s0">'</span><span class="s4">workbox-routing</span><span class="s0">',</span>
        <span class="s0">'</span><span class="s4">workbox-strategies</span><span class="s0">'</span>
      <span class="s2">]</span>
    <span class="s0">},</span>
    <span class="s2">plugins</span><span class="s0">: </span><span class="s2">[</span>
      <span class="s0">productionMode &amp;&amp; </span><span class="s6">brotli</span><span class="s2">()</span><span class="s0">,</span>
      <span class="s0">devMode &amp;&amp; </span><span class="s6">vaadinBundlesPlugin</span><span class="s2">()</span><span class="s0">,</span>
      <span class="s0">devMode &amp;&amp; </span><span class="s6">showRecompileReason</span><span class="s2">()</span><span class="s0">,</span>
      <span class="s0">settings.offlineEnabled &amp;&amp; </span><span class="s6">serviceWorkerPlugin</span><span class="s2">(</span><span class="s0">{</span>
        <span class="s2">srcPath</span><span class="s0">: settings.clientServiceWorkerSource,</span>
      <span class="s0">}</span><span class="s2">)</span><span class="s0">,</span>
      <span class="s0">!devMode &amp;&amp; </span><span class="s6">statsExtracterPlugin</span><span class="s2">()</span><span class="s0">,</span>
      <span class="s0">!productionMode &amp;&amp; </span><span class="s6">preserveUsageStats</span><span class="s2">()</span><span class="s0">,</span>
      <span class="s6">themePlugin</span><span class="s2">(</span><span class="s0">{ devMode }</span><span class="s2">)</span><span class="s0">,</span>
      <span class="s6">postcssLit</span><span class="s2">(</span><span class="s0">{</span>
        <span class="s2">include</span><span class="s0">: </span><span class="s2">[</span><span class="s0">'</span><span class="s4">**/*.css</span><span class="s0">', /</span><span class="s5">.</span><span class="s0">*</span><span class="s7">\/</span><span class="s5">.</span><span class="s0">*</span><span class="s7">\.</span><span class="s10">css</span><span class="s7">\?</span><span class="s5">.</span><span class="s0">*/</span><span class="s2">]</span><span class="s0">,</span>
        <span class="s2">exclude</span><span class="s0">: </span><span class="s2">[</span>
          <span class="s0">`${themeFolder}</span><span class="s4">/**/*.css</span><span class="s0">`,</span>
          <span class="s0">new </span><span class="s6">RegExp</span><span class="s2">(</span><span class="s0">`${themeFolder}</span><span class="s4">/.*/.*</span><span class="s7">\\</span><span class="s4">.css</span><span class="s7">\\</span><span class="s4">?.*</span><span class="s0">`</span><span class="s2">)</span><span class="s0">,</span>
          <span class="s0">`${themeResourceFolder}</span><span class="s4">/**/*.css</span><span class="s0">`,</span>
          <span class="s0">new </span><span class="s6">RegExp</span><span class="s2">(</span><span class="s0">`${themeResourceFolder}</span><span class="s4">/.*/.*</span><span class="s7">\\</span><span class="s4">.css</span><span class="s7">\\</span><span class="s4">?.*</span><span class="s0">`</span><span class="s2">)</span><span class="s0">,</span>
          <span class="s0">new </span><span class="s6">RegExp</span><span class="s2">(</span><span class="s0">'</span><span class="s4">.*/.*</span><span class="s7">\\</span><span class="s4">?html-proxy.*</span><span class="s0">'</span><span class="s2">)</span>
        <span class="s2">]</span>
      <span class="s0">}</span><span class="s2">)</span><span class="s0">,</span>
      <span class="s0">// </span><span class="s1">The React plugin provides fast refresh and debug source info</span>
      <span class="s6">reactPlugin</span><span class="s2">(</span><span class="s0">{</span>
        <span class="s2">include</span><span class="s0">: '</span><span class="s4">**/*.tsx</span><span class="s0">',</span>
        <span class="s2">babel</span><span class="s0">: {</span>
          <span class="s0">// </span><span class="s1">We need to use babel to provide the source information for it to be correct</span>
          <span class="s0">// </span><span class="s1">(otherwise Babel will slightly rewrite the source file and esbuild generate source info for the modified file)</span>
          <span class="s2">presets</span><span class="s0">: </span><span class="s2">[</span>
            <span class="s2">[</span>
              <span class="s0">'</span><span class="s4">@babel/preset-react</span><span class="s0">',</span>
              <span class="s0">{</span>
                <span class="s2">runtime</span><span class="s0">: '</span><span class="s4">automatic</span><span class="s0">',</span>
                <span class="s2">importSource</span><span class="s0">: productionMode ? '</span><span class="s4">react</span><span class="s0">' : '</span><span class="s4">Frontend/generated/jsx-dev-transform</span><span class="s0">',</span>
                <span class="s2">development</span><span class="s0">: !productionMode</span>
              <span class="s0">}</span>
            <span class="s2">]</span>
          <span class="s2">]</span><span class="s0">,</span>
          <span class="s0">// </span><span class="s1">React writes the source location for where components are used, this writes for where they are defined</span>
          <span class="s2">plugins</span><span class="s0">: </span><span class="s2">[</span>
            <span class="s0">!productionMode &amp;&amp; </span><span class="s6">addFunctionComponentSourceLocationBabel</span><span class="s2">()</span><span class="s0">,</span>
            <span class="s2">[</span>
              <span class="s0">'</span><span class="s4">module:@preact/signals-react-transform</span><span class="s0">',</span>
              <span class="s0">{</span>
                <span class="s2">mode</span><span class="s0">: '</span><span class="s4">all</span><span class="s0">' // </span><span class="s1">Needed to include translations which do not use something.value</span>
              <span class="s0">}</span>
            <span class="s2">]</span>
          <span class="s2">]</span><span class="s0">.</span><span class="s6">filter</span><span class="s2">(</span><span class="s0">Boolean</span><span class="s2">)</span>
        <span class="s0">}</span>
      <span class="s0">}</span><span class="s2">)</span><span class="s0">,</span>
      <span class="s0">productionMode &amp;&amp; </span><span class="s6">vaadinI18n</span><span class="s2">(</span><span class="s0">{</span>
        <span class="s2">cwd</span><span class="s0">: __dirname,</span>
        <span class="s2">meta</span><span class="s0">: {</span>
          <span class="s2">output</span><span class="s0">: {</span>
            <span class="s2">dir</span><span class="s0">: i18nFolder,</span>
          <span class="s0">},</span>
        <span class="s0">},</span>
      <span class="s0">}</span><span class="s2">)</span><span class="s0">,</span>
      <span class="s0">{</span>
        <span class="s2">name</span><span class="s0">: '</span><span class="s4">vaadin:force-remove-html-middleware</span><span class="s0">',</span>
        <span class="s6">configureServer</span><span class="s0">(server) {</span>
          <span class="s3">return </span><span class="s0">() </span><span class="s3">=&gt; </span><span class="s0">{</span>
            <span class="s0">server.middlewares.stack = server.middlewares.stack.</span><span class="s6">filter</span><span class="s2">(</span><span class="s0">(mw) </span><span class="s3">=&gt; </span><span class="s0">{</span>
              <span class="s3">const </span><span class="s0">handleName = `${mw.handle}`;</span>
              <span class="s3">return </span><span class="s0">!handleName.</span><span class="s6">includes</span><span class="s2">(</span><span class="s0">'</span><span class="s4">viteHtmlFallbackMiddleware</span><span class="s0">'</span><span class="s2">)</span><span class="s0">;</span>
            <span class="s0">}</span><span class="s2">)</span><span class="s0">;</span>
          <span class="s0">};</span>
        <span class="s0">},</span>
      <span class="s0">},</span>
      <span class="s0">hasExportedWebComponents &amp;&amp; {</span>
        <span class="s2">name</span><span class="s0">: '</span><span class="s4">vaadin:inject-entrypoints-to-web-component-html</span><span class="s0">',</span>
        <span class="s2">transformIndexHtml</span><span class="s0">: {</span>
          <span class="s2">order</span><span class="s0">: '</span><span class="s4">pre</span><span class="s0">',</span>
          <span class="s6">handler</span><span class="s0">(_html, { path, server }) {</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s0">path !== '</span><span class="s4">/web-component.html</span><span class="s0">'</span><span class="s2">) </span><span class="s0">{</span>
              <span class="s3">return</span><span class="s0">;</span>
            <span class="s0">}</span>
            <span class="s3">const </span><span class="s0">scripts = </span><span class="s2">[</span>
              <span class="s0">{</span>
                <span class="s2">tag</span><span class="s0">: '</span><span class="s4">script</span><span class="s0">',</span>
                <span class="s2">attrs</span><span class="s0">: { </span><span class="s2">type</span><span class="s0">: '</span><span class="s4">module</span><span class="s0">', </span><span class="s2">src</span><span class="s0">: `</span><span class="s4">/generated/vaadin-web-component.ts</span><span class="s0">` },</span>
                <span class="s2">injectTo</span><span class="s0">: '</span><span class="s4">head</span><span class="s0">'</span>
              <span class="s0">}</span>
            <span class="s2">]</span><span class="s0">;</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s0">commercialBanner</span><span class="s2">) </span><span class="s0">{</span>
              <span class="s0">scripts.</span><span class="s6">push</span><span class="s2">(</span><span class="s0">{</span>
                <span class="s2">tag</span><span class="s0">: '</span><span class="s4">script</span><span class="s0">',</span>
                <span class="s2">attrs</span><span class="s0">: { </span><span class="s2">type</span><span class="s0">: '</span><span class="s4">module</span><span class="s0">', </span><span class="s2">src</span><span class="s0">: '</span><span class="s4">/generated/commercial-banner.js</span><span class="s0">' },</span>
                <span class="s2">injectTo</span><span class="s0">: '</span><span class="s4">head</span><span class="s0">'</span>
              <span class="s0">}</span><span class="s2">)</span><span class="s0">;</span>
            <span class="s0">}</span>
            <span class="s3">return </span><span class="s0">scripts;</span>
          <span class="s0">}</span>
        <span class="s0">}</span>
      <span class="s0">},</span>
      <span class="s0">{</span>
        <span class="s2">name</span><span class="s0">: '</span><span class="s4">vaadin:inject-entrypoints-to-index-html</span><span class="s0">',</span>
        <span class="s2">transformIndexHtml</span><span class="s0">: {</span>
          <span class="s2">order</span><span class="s0">: '</span><span class="s4">pre</span><span class="s0">',</span>
          <span class="s6">handler</span><span class="s0">(_html, { path, server }) {</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s0">path !== '</span><span class="s4">/index.html</span><span class="s0">'</span><span class="s2">) </span><span class="s0">{</span>
              <span class="s3">return</span><span class="s0">;</span>
            <span class="s0">}</span>

            <span class="s3">const </span><span class="s0">scripts = </span><span class="s2">[]</span><span class="s0">;</span>

            <span class="s3">if </span><span class="s2">(</span><span class="s0">devMode</span><span class="s2">) </span><span class="s0">{</span>
              <span class="s0">scripts.</span><span class="s6">push</span><span class="s2">(</span><span class="s0">{</span>
                <span class="s2">tag</span><span class="s0">: '</span><span class="s4">script</span><span class="s0">',</span>
                <span class="s2">attrs</span><span class="s0">: { </span><span class="s2">type</span><span class="s0">: '</span><span class="s4">module</span><span class="s0">', </span><span class="s2">src</span><span class="s0">: `</span><span class="s4">/generated/vite-devmode.ts</span><span class="s0">`, </span><span class="s2">onerror</span><span class="s0">: &quot;</span><span class="s4">document.location.reload()</span><span class="s0">&quot; },</span>
                <span class="s2">injectTo</span><span class="s0">: '</span><span class="s4">head</span><span class="s0">'</span>
              <span class="s0">}</span><span class="s2">)</span><span class="s0">;</span>
            <span class="s0">}</span>
            <span class="s0">scripts.</span><span class="s6">push</span><span class="s2">(</span><span class="s0">{</span>
              <span class="s2">tag</span><span class="s0">: '</span><span class="s4">script</span><span class="s0">',</span>
              <span class="s2">attrs</span><span class="s0">: { </span><span class="s2">type</span><span class="s0">: '</span><span class="s4">module</span><span class="s0">', </span><span class="s2">src</span><span class="s0">: '</span><span class="s4">/generated/vaadin.ts</span><span class="s0">' },</span>
              <span class="s2">injectTo</span><span class="s0">: '</span><span class="s4">head</span><span class="s0">'</span>
            <span class="s0">}</span><span class="s2">)</span><span class="s0">;</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s0">commercialBanner</span><span class="s2">) </span><span class="s0">{</span>
              <span class="s0">scripts.</span><span class="s6">push</span><span class="s2">(</span><span class="s0">{</span>
                <span class="s2">tag</span><span class="s0">: '</span><span class="s4">script</span><span class="s0">',</span>
                <span class="s2">attrs</span><span class="s0">: { </span><span class="s2">type</span><span class="s0">: '</span><span class="s4">module</span><span class="s0">', </span><span class="s2">src</span><span class="s0">: '</span><span class="s4">/generated/commercial-banner.js</span><span class="s0">' },</span>
                <span class="s2">injectTo</span><span class="s0">: '</span><span class="s4">head</span><span class="s0">'</span>
              <span class="s0">}</span><span class="s2">)</span><span class="s0">;</span>
            <span class="s0">}</span>
            <span class="s3">return </span><span class="s0">scripts;</span>
          <span class="s0">}</span>
        <span class="s0">}</span>
      <span class="s0">},</span>
      
      <span class="s6">checker</span><span class="s2">(</span><span class="s0">{</span>
        <span class="s2">typescript</span><span class="s0">: </span><span class="s5">true</span>
      <span class="s0">}</span><span class="s2">)</span><span class="s0">,</span>
      <span class="s0">productionMode &amp;&amp; </span><span class="s6">visualizer</span><span class="s2">(</span><span class="s0">{ </span><span class="s2">brotliSize</span><span class="s0">: </span><span class="s5">true</span><span class="s0">, </span><span class="s2">filename</span><span class="s0">: bundleSizeFile }</span><span class="s2">)</span>
    <span class="s2">]</span>
  <span class="s0">};</span>
<span class="s0">};</span>

<span class="s3">export const </span><span class="s6">overrideVaadinConfig </span><span class="s0">= (customConfig: UserConfigFn) </span><span class="s3">=&gt; </span><span class="s0">{</span>
  <span class="s3">return </span><span class="s6">defineConfig</span><span class="s2">(</span><span class="s0">(env) </span><span class="s3">=&gt; </span><span class="s6">mergeConfig</span><span class="s2">(</span><span class="s6">vaadinConfig</span><span class="s2">(</span><span class="s0">env</span><span class="s2">)</span><span class="s0">, </span><span class="s6">customConfig</span><span class="s2">(</span><span class="s0">env</span><span class="s2">)))</span><span class="s0">;</span>
<span class="s0">};</span>
<span class="s3">function </span><span class="s6">getVersion</span><span class="s0">(module: string): string {</span>
  <span class="s3">const </span><span class="s0">packageJson = path.</span><span class="s6">resolve</span><span class="s2">(</span><span class="s0">nodeModulesFolder, module, '</span><span class="s4">package.json</span><span class="s0">'</span><span class="s2">)</span><span class="s0">;</span>
  <span class="s3">return </span><span class="s0">JSON.</span><span class="s6">parse</span><span class="s2">(</span><span class="s6">readFileSync</span><span class="s2">(</span><span class="s0">packageJson, { </span><span class="s2">encoding</span><span class="s0">: '</span><span class="s4">utf-8</span><span class="s0">' }</span><span class="s2">))</span><span class="s0">.version;</span>
<span class="s0">}</span>
<span class="s3">function </span><span class="s6">getCvdlName</span><span class="s0">(module: string): string {</span>
  <span class="s3">const </span><span class="s0">packageJson = path.</span><span class="s6">resolve</span><span class="s2">(</span><span class="s0">nodeModulesFolder, module, '</span><span class="s4">package.json</span><span class="s0">'</span><span class="s2">)</span><span class="s0">;</span>
  <span class="s3">return </span><span class="s0">JSON.</span><span class="s6">parse</span><span class="s2">(</span><span class="s6">readFileSync</span><span class="s2">(</span><span class="s0">packageJson, { </span><span class="s2">encoding</span><span class="s0">: '</span><span class="s4">utf-8</span><span class="s0">' }</span><span class="s2">))</span><span class="s0">.cvdlName;</span>
<span class="s0">}</span>
</pre>
</body>
</html>